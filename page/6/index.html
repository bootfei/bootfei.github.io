<!DOCTYPE html>
<html lang="en,cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta name="description" content="learn more, forget more; practice more, get more.">
<meta property="og:type" content="website">
<meta property="og:title" content="BootFei&#39;s Blog">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="BootFei&#39;s Blog">
<meta property="og:description" content="learn more, forget more; practice more, get more.">
<meta property="og:locale">
<meta property="article:author" content="Fei Qi">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/6/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en,cn'
  };
</script>

  <title>BootFei's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">BootFei's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">敬畏耶和华是智慧的开端，认识至圣者就是聪明</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Fei Qi</p>
  <div class="site-description" itemprop="description">learn more, forget more; practice more, get more.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">177</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/31/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/redisson-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%8F%AA%E6%89%A7%E8%A1%8C1%E6%AC%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/31/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/redisson-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%8F%AA%E6%89%A7%E8%A1%8C1%E6%AC%A1/" class="post-title-link" itemprop="url">redisson-分布式锁和定时任务只执行1次</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-03-31 15:15:55 / Modified: 15:25:58" itemprop="dateCreated datePublished" datetime="2021-03-31T15:15:55+08:00">2021-03-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisson.getLock();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="定时任务执行一次"><a href="#定时任务执行一次" class="headerlink" title="定时任务执行一次"></a>定时任务执行一次</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#其他服务获取锁失败，直接return结束任务</span><br><span class="line">if(redisson.getLock())</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/Idea%20intellij/intellij-%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/30/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/Idea%20intellij/intellij-%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">intellij-常用快捷键</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-03-30 09:03:42 / Modified: 09:31:24" itemprop="dateCreated datePublished" datetime="2021-03-30T09:03:42+08:00">2021-03-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Build-a-type-hierarchy"><a href="#Build-a-type-hierarchy" class="headerlink" title="Build a type hierarchy﻿"></a>Build a type hierarchy﻿</h3><ol>
<li><p>Select the desired class in the <strong>Project</strong> tool window or open it in the editor.</p>
</li>
<li><p>From the main menu, select <strong>Navigate | Type Hierarchy</strong> or just press ⌃H.</p>
<img src="https://resources.jetbrains.com/help/img/idea/2020.3/java_type_hierarchy.png" alt="Class hierarchy shown in the Hierarchy Tool Window" style="zoom:33%;" />

</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/29/Christ/%E4%B8%BB%E6%97%A5%E8%AE%B2%E9%81%93/2021-03-29/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/29/Christ/%E4%B8%BB%E6%97%A5%E8%AE%B2%E9%81%93/2021-03-29/" class="post-title-link" itemprop="url">2021-03-29主日讲道</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-29 13:54:56" itemprop="dateCreated datePublished" datetime="2021-03-29T13:54:56+08:00">2021-03-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-03-28 11:04:03" itemprop="dateModified" datetime="2021-03-28T11:04:03+08:00">2021-03-28</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>马太7：7-12</p>
<p>唐崇荣</p>
<ul>
<li><p>你们对儿女的心，就是天父对我们的心意</p>
</li>
<li><p>儿子求饼是为了吃，为了滋养生命，父亲肯定会供应他们的需要；亲情，特别是骨肉，肯定会照顾他</p>
</li>
<li><p>“你们虽然不好”</p>
<ul>
<li>说明我们即便得救了，对别人也不好；我们即便做了好事，也可能出于不好的动机。</li>
<li>即便我们对别人不好，但是我们对自己的骨肉，却是非常好</li>
</ul>
</li>
</ul>
<p>无神论两大动机：</p>
<ul>
<li>体会到不公平，就把上帝当成埋怨的对象，因为上帝的公义没法彰显</li>
<li>自己犯错了，不想被审判，就相信没有神</li>
</ul>
<p>无神论的弱点：</p>
<ul>
<li>现实和我们的盼望常常事与愿违，他们不懂得“我们行善不可灰心，要忍耐等候”</li>
</ul>
<p>儿女脾气爆发的原因</p>
<ul>
<li>反映了父母也是用这个态度对待儿女的</li>
</ul>
<ul>
<li>上帝注重的是大体、宏观和绝对<ul>
<li>上帝赐予的是绝对的好、全面的好</li>
<li>圣灵是最大的恩赐，恩赐上的恩赐</li>
</ul>
</li>
<li>人注重的是细节，求有车子、有房子、儿女平安<ul>
<li>我只看见部分，忽略了整体的美好</li>
<li>健康好，是好的，但不是绝对的好，可能去犯贱淫</li>
<li>金钱好，是好的，但不是绝对的好，可能去读博</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/23/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/git/git%E5%B8%B8%E8%A7%81%E4%B8%9A%E5%8A%A1%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/23/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/git/git%E5%B8%B8%E8%A7%81%E4%B8%9A%E5%8A%A1%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">git常见业务操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-23 09:46:30" itemprop="dateCreated datePublished" datetime="2021-03-23T09:46:30+08:00">2021-03-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-03-26 13:47:12" itemprop="dateModified" datetime="2021-03-26T13:47:12+08:00">2021-03-26</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="从master分支中创建自己的远程分支"><a href="#从master分支中创建自己的远程分支" class="headerlink" title="从master分支中创建自己的远程分支"></a>从master分支中创建自己的远程分支</h1><h2 id="First-you-create-your-branch-locally"><a href="#First-you-create-your-branch-locally" class="headerlink" title="First, you create your branch locally:"></a>First, you create your branch locally:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branch-name&gt; # Create a new branch and check it out</span><br></pre></td></tr></table></figure>

<p>The remote branch is automatically created when you push it to the remote server. </p>
<h2 id="So-when-you-feel-ready-for-it-you-can-do"><a href="#So-when-you-feel-ready-for-it-you-can-do" class="headerlink" title="So when you feel ready for it, you can do:"></a>So when you feel ready for it, you can do:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push &lt;remote-name&gt; &lt;branch-name&gt; </span><br></pre></td></tr></table></figure>

<p>Where <code>&lt;remote-name&gt;</code> is typically <code>origin</code>, the name which git gives to the remote you cloned from. Your colleagues would then just pull that branch, and it’s automatically created locally.</p>
<p>Note however that formally, the format is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push &lt;remote-name&gt; &lt;local-branch-name&gt;:&lt;remote-branch-name&gt;</span><br></pre></td></tr></table></figure>

<p>But when you omit one, it assumes both branch names are the same. Having said this, as a word of <strong>caution</strong>, do not make the critical mistake of specifying only <code>:&lt;remote-branch-name&gt;</code> (with the colon), or the remote branch will be deleted!</p>
<h2 id="So-that-a-subsequent-git-pull-will-know-what-to-do-you-might-instead-want-to-use"><a href="#So-that-a-subsequent-git-pull-will-know-what-to-do-you-might-instead-want-to-use" class="headerlink" title="So that a subsequent git pull will know what to do, you might instead want to use:"></a>So that a subsequent <code>git pull</code> will know what to do, you might instead want to use:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream &lt;remote-name&gt; &lt;local-branch-name&gt; </span><br></pre></td></tr></table></figure>

<p>As described below, the <code>--set-upstream</code> option sets up an upstream branch:</p>
<blockquote>
<p>For every branch that is up to date or successfully pushed, add upstream (tracking) reference, used by argument-less git-pull(1) and other commands.</p>
</blockquote>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch -vv</span><br><span class="line">* developing 3411786 [origin/developing] qifei</span><br><span class="line">  master     3411786 [origin/master] qifei</span><br></pre></td></tr></table></figure>





<h1 id="或者"><a href="#或者" class="headerlink" title="或者"></a>或者</h1><h2 id="Switch-to-a-Branch-That-Came-From-a-Remote-Repo"><a href="#Switch-to-a-Branch-That-Came-From-a-Remote-Repo" class="headerlink" title="Switch to a Branch That Came From a Remote Repo"></a>Switch to a Branch That Came From a Remote Repo</h2><ol>
<li>To get a list of all branches from the remote, run this command:<ul>
<li><strong>git pull</strong></li>
</ul>
</li>
<li>Run this command to switch to the branch:<ul>
<li><strong>git checkout –track origin/my-branch-name</strong></li>
</ul>
</li>
</ol>
<h2 id="Push-to-a-Branch"><a href="#Push-to-a-Branch" class="headerlink" title="Push to a Branch"></a>Push to a Branch</h2><ul>
<li>If your local branch does not exist on the remote, run either of these commands:<ul>
<li><strong>git push -u origin my-branch-name</strong></li>
<li><strong>git push -u origin HEAD</strong></li>
</ul>
</li>
</ul>
<p><strong>NOTE:</strong> HEAD is a reference to the top of the current branch, so it’s an easy way to push to a branch of the same name on the remote. This saves you from having to type out the exact name of the branch!</p>
<ul>
<li>If your local branch</li>
</ul>
<p>  already exists </p>
<p>  on the remote, run this command:</p>
<ul>
<li><strong>git push</strong></li>
</ul>
<h2 id="Merge-a-Branch"><a href="#Merge-a-Branch" class="headerlink" title="Merge a Branch"></a>Merge a Branch</h2><ol>
<li>You’ll want to make sure your working tree is clean and see what branch you’re on. Run this command:<ul>
<li><strong>git status</strong></li>
</ul>
</li>
<li>First, you must check out the branch that you want to merge another branch into (changes will be merged into this branch). If you’re not already on the desired branch, run this command:<ul>
<li><strong>git checkout master</strong></li>
<li><strong>NOTE:</strong> Replace <strong>master</strong> with another branch name as needed.</li>
</ul>
</li>
<li>Now you can merge another branch into the current branch. Run this command:<ul>
<li><strong>git merge my-branch-name</strong></li>
<li><strong>NOTE:</strong> When you merge, there may be a conflict. Refer to <strong>Handling Merge Conflicts</strong> (the next exercise) to learn what to do.</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/20/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/20/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-20 20:05:51" itemprop="dateCreated datePublished" datetime="2021-03-20T20:05:51+08:00">2021-03-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-04-08 13:11:53" itemprop="dateModified" datetime="2021-04-08T13:11:53+08:00">2021-04-08</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>以下伪代码是一个保存订单的功能，并会发送短信消息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class OrderServiceImpl implements OrderService &#123;</span><br><span class="line">    public void saveOrder() &#123;</span><br><span class="line">        System.out.println(&quot;订单创建成功&quot;);&#x2F;&#x2F;1.创建订单</span><br><span class="line">        System.out.println(&quot;恭喜您订单创建成功！----by sms&quot;);&#x2F;&#x2F;2.1 发送短信通知      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现有新需求：需要加一个微信通知的功能，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class OrderServiceImpl implements OrderService &#123;</span><br><span class="line">    public void saveOrder() &#123;  </span><br><span class="line">        System.out.println(&quot;订单创建成功&quot;);&#x2F;&#x2F;1.创建订单</span><br><span class="line">        </span><br><span class="line">        System.out.println(&quot;恭喜您订单创建成功！----by sms&quot;);&#x2F;&#x2F;2.1 发送短信通知      </span><br><span class="line">        System.out.println(&quot;恭喜您订单创建成功！----by wechat&quot;); &#x2F;&#x2F;2.2 发送微信通知</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>存在问题：每次创建订单需要加新功能（如新的通知方式），则要修改原有的类，难以维护。</p>
<p>违背设计模式的原则</p>
<ol>
<li>单一职责：订单保存功能，杂糅了消息通知这些功能</li>
<li>开闭原则：对拓展开放，对修改关闭</li>
</ol>
<p>优化方案：使用观察者模式，使创建订单和消息通知进行分离，低耦合。可以选择消息队列，spring事件机制等，本文选择Spring事件机制。</p>
<h3 id="改造开始"><a href="#改造开始" class="headerlink" title="改造开始"></a>改造开始</h3><h4 id="创建事件"><a href="#创建事件" class="headerlink" title="创建事件"></a>创建事件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.ApplicationEvent; </span><br><span class="line">&#x2F;**</span><br><span class="line">* 订单创建活动事件</span><br><span class="line">*&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class OrderCreateEvent extends ApplicationEvent &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    </span><br><span class="line">    private List&lt;String&gt; contentList;&#x2F;&#x2F;消息参数</span><br><span class="line"> </span><br><span class="line">    public OrderCreateEvent(Object source, String name, List&lt;String&gt; contentList) &#123;</span><br><span class="line">        super(source);</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">        this.contentList &#x3D; contentList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 短信监听器</span></span><br><span class="line"><span class="comment">* ApplicationListener是无序的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">OrderCreateEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(OrderCreateEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//发送短信</span></span><br><span class="line">        System.out.println(event.getContentList().get(<span class="number">0</span>) + <span class="string">&quot;,您的订单:&quot;</span> + event.getContentList().get(<span class="number">1</span>) + <span class="string">&quot;创建成功! ----by sms&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 微信监听器</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">OrderCreateEvent</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(OrderCreateEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//发送微信</span></span><br><span class="line">        System.out.println(event.getContentList().get(<span class="number">0</span>) + <span class="string">&quot;,您的订单:&quot;</span> + event.getContentList().get(<span class="number">1</span>) + <span class="string">&quot;创建成功! ----by wechat&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="事件发布"><a href="#事件发布" class="headerlink" title="事件发布"></a>事件发布</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pengshu.magicwallet.admin.test;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建订单</span></span><br><span class="line">        System.out.println(<span class="string">&quot;订单创建成功&quot;</span>);</span><br><span class="line">        <span class="comment">//2.发布事件通知</span></span><br><span class="line">        ArrayList&lt;String&gt; contentList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        contentList.add(<span class="string">&quot;heling&quot;</span>);</span><br><span class="line">        contentList.add(<span class="string">&quot;123456789&quot;</span>);</span><br><span class="line">        OrderCreateEvent orderCreateEvent = <span class="keyword">new</span> OrderCreateEvent(<span class="keyword">this</span>, <span class="string">&quot;订单创建&quot;</span>, contentList);</span><br><span class="line">        applicationContext.publishEvent(orderCreateEvent);<span class="comment">//ApplicationContext是我们的事件容器上层，我们发布事件，也可以通过此容器完成发布</span></span><br><span class="line">        <span class="comment">//applicationEventPublisher.publishEvent(orderCreateEvent);//也可以</span></span><br><span class="line">        System.out.println(<span class="string">&quot;finished!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">订单创建成功</span><br><span class="line"></span><br><span class="line">heling,您的订单:123456789创建成功! ----by sms</span><br><span class="line"></span><br><span class="line">heling,您的订单:123456789创建成功! ----by wechat</span><br><span class="line"></span><br><span class="line">finished!</span><br></pre></td></tr></table></figure>

<h3 id="如何异步执行监听器？"><a href="#如何异步执行监听器？" class="headerlink" title="如何异步执行监听器？"></a>如何异步执行监听器？</h3><h4 id="springboot开启事件异步设置"><a href="#springboot开启事件异步设置" class="headerlink" title="springboot开启事件异步设置"></a>springboot开启事件异步设置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.pengshu.magicwallet.mapper&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:authority.properties&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@EnableAsync</span> <span class="comment">//开启spring事件异步设置，加@Async注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MagicWalletAdminApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MagicWalletAdminApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="监听器类或方法添加-Async注解"><a href="#监听器类或方法添加-Async注解" class="headerlink" title="监听器类或方法添加@Async注解"></a>监听器类或方法添加@Async注解</h4><p>打印结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">订单创建成功</span><br><span class="line"></span><br><span class="line">finished!</span><br><span class="line"></span><br><span class="line">heling,您的订单:123456789创建成功! ----by sms</span><br><span class="line"></span><br><span class="line">heling,您的订单:123456789创建成功! ----by wechat</span><br></pre></td></tr></table></figure>

<h3 id="如何制定监听器执行顺序？"><a href="#如何制定监听器执行顺序？" class="headerlink" title="如何制定监听器执行顺序？"></a>如何制定监听器执行顺序？</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 微信监听器</span></span><br><span class="line"><span class="comment">* SmartApplicationListener可以设置顺序等</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatListener</span> <span class="keyword">implements</span> <span class="title">SmartApplicationListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//设置监听优先级</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//监听器智能所在之一，能够根据事件类型动态监听</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsEventType</span><span class="params">(Class&lt;? extends ApplicationEvent&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aClass == OrderCreateEvent.class;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//监听器智能所在之二，能够根据事件发布者类型动态监听</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsSourceType</span><span class="params">(Class&lt;?&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aClass == OrderServiceImpl.class;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">  	<span class="meta">@Async</span><span class="comment">//开启异步</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent applicationEvent)</span> </span>&#123;</span><br><span class="line">        OrderCreateEvent event = (OrderCreateEvent) applicationEvent;</span><br><span class="line">        <span class="comment">//发送微信</span></span><br><span class="line">        System.out.println(event.getContentList().get(<span class="number">0</span>) + <span class="string">&quot;,您的订单:&quot;</span> + event.getContentList().get(<span class="number">1</span>) + <span class="string">&quot;创建成功! ----by wechat&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 短信监听器</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsListener</span> <span class="keyword">implements</span> <span class="title">SmartApplicationListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsEventType</span><span class="params">(Class&lt;? extends ApplicationEvent&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aClass == OrderCreateEvent.class;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsSourceType</span><span class="params">(Class&lt;?&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aClass == OrderServiceImpl.class;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">  	<span class="meta">@Async</span> <span class="comment">//开启异步</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent applicationEvent)</span> </span>&#123;</span><br><span class="line">        OrderCreateEvent event = (OrderCreateEvent) applicationEvent;</span><br><span class="line">        <span class="comment">//发送短信</span></span><br><span class="line">        System.out.println(event.getContentList().get(<span class="number">0</span>) + <span class="string">&quot;,您的订单:&quot;</span> + event.getContentList().get(<span class="number">1</span>) + <span class="string">&quot;创建成功! ----by sms&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">订单创建成功</span><br><span class="line"></span><br><span class="line">heling,您的订单:123456789创建成功! ----by wechat</span><br><span class="line"></span><br><span class="line">heling,您的订单:123456789创建成功! ----by sms</span><br><span class="line"></span><br><span class="line">finished!</span><br></pre></td></tr></table></figure>

<p>在实现了SmartApplicationListener的监听器中，我们通过重写GetOrder方法来修改不同监听器的顺序，<strong>优先级越小，则越先被调用</strong>。通过配置不同的优先级，且让监听器之间阻塞调用。我们就能实现流水线式的有序事件调用，这在实际应用场景中还是蛮有意义的</p>
<h1 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h1><h2 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h2><h2 id="实践-1"><a href="#实践-1" class="headerlink" title="实践"></a>实践</h2><p>用户可以选择多种支付方式，比如微信、支付宝、网银等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#公共接口</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Payment</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(Long order, <span class="keyword">double</span> amount)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#具体实现</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliPay</span> <span class="keyword">implements</span> <span class="title">Payment</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(Long order, <span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----支付宝支付----&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;支付宝支付111元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="使用前"><a href="#使用前" class="headerlink" title="使用前"></a>使用前</h3><p>if判断非常的多</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/makeOrder&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResultData <span class="title">makeOrder</span><span class="params">(<span class="meta">@RequestBody</span>  Order order)</span></span>&#123;</span><br><span class="line">  <span class="comment">// 生成自己的订单，并且设置订单的失效时间，并且定时回滚</span></span><br><span class="line">  <span class="comment">//  ... 此处代码省略</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理支付方式</span></span><br><span class="line">  <span class="keyword">if</span>(order.getType==<span class="string">&quot;alipay&quot;</span>)&#123; <span class="comment">// 支付宝</span></span><br><span class="line">    <span class="keyword">this</span>.payService.alipay(order);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (order.getType==<span class="string">&quot;weixin&quot;</span>)&#123; <span class="comment">// 微信</span></span><br><span class="line">    <span class="keyword">this</span>.payService.weixinpay(order);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (order.getType==<span class="string">&quot;jd&quot;</span>)&#123; <span class="comment">// 京东支付</span></span><br><span class="line">    <span class="keyword">this</span>.payService.jtpay(order);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (order.getType==<span class="string">&quot;yunshanfu&quot;</span>)&#123; <span class="comment">// 云闪付</span></span><br><span class="line">    <span class="keyword">this</span>.payService.yunshanfupay(order);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发送到mq，进行广播。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.ok(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用后"><a href="#使用后" class="headerlink" title="使用后"></a>使用后</h3><p>增加一个枚举类，封装各种策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">PayType</span> </span>&#123;</span><br><span class="line">    <span class="comment">//封装各种策略的实现</span></span><br><span class="line">    ALI_PAY(<span class="string">&quot;1&quot;</span>,<span class="keyword">new</span> AliPay()),</span><br><span class="line">    WECHAT_PAY(<span class="string">&quot;2&quot;</span>,<span class="keyword">new</span> WechatPay());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String payType;</span><br><span class="line">    <span class="keyword">private</span> Payment payment;</span><br><span class="line">  </span><br><span class="line">    PayType(String payType,Payment payment)&#123;</span><br><span class="line">        <span class="keyword">this</span>.payment = payment;</span><br><span class="line">        <span class="keyword">this</span>.payType = payType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过get方法获取支付方式</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Payment <span class="title">get</span><span class="params">(String payType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (PayType e : PayType.values()) &#123; <span class="comment">//values就是ALI_PAY和WECHAT_PAY</span></span><br><span class="line">            <span class="keyword">if</span> (e.payType.equals(payType)) &#123;</span><br><span class="line">                <span class="keyword">return</span> e.payment;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过枚举类，省略了很多if语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ResultData <span class="title">makeOrder</span><span class="params">(Long goodsId,String type)</span></span>&#123;</span><br><span class="line">  <span class="comment">//生成本地的订单</span></span><br><span class="line">  Order order = <span class="keyword">this</span>.orderService.makeOrder(goodsId);</span><br><span class="line">  <span class="comment">//选择支付方式</span></span><br><span class="line">  Payment payment = PayType.get(type);</span><br><span class="line">  <span class="comment">//进行支付</span></span><br><span class="line">  payment.pay(order.getId(),order.getAmount());</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/17/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/git/git-pull%E6%8A%A5%E9%94%99-unable-to-access-https-github-com/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/17/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/git/git-pull%E6%8A%A5%E9%94%99-unable-to-access-https-github-com/" class="post-title-link" itemprop="url">git pull报错-unable to access 'https://github.com/....':</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-03-17 11:10:48 / Modified: 11:11:44" itemprop="dateCreated datePublished" datetime="2021-03-17T11:10:48+08:00">2021-03-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>I think it happened maybe because of https but I am not very sure. You can Switch remote URLs from HTTPS to SSH.</p>
<p><a target="_blank" rel="noopener" href="https://docs.github.com/en/github/using-git/changing-a-remotes-url">如何从HTTPS切换到SSH参照官网</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/17/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/Distributed%20Streaming%20Platform/Kafka/kafka-01-%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/17/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/Distributed%20Streaming%20Platform/Kafka/kafka-01-%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-17 11:06:07" itemprop="dateCreated datePublished" datetime="2021-03-17T11:06:07+08:00">2021-03-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>title: kafka-01-原理<br>date: 2021-02-13 17:05:46<br>tags:</p>
<h1 id="Kafka-概述"><a href="#Kafka-概述" class="headerlink" title="Kafka 概述"></a><strong>Kafka</strong> 概述</h1><p>Apache Kafka 是一个快速、可扩展的、高吞吐的、可容错的分布式“发布-订阅”消息系统， 使用 Scala 与 Java 语言编写，能够将消息从一个端点传递到另一个端点，较之传统的消息中 间件(例如 ActiveMQ、RabbitMQ)，Kafka 具有高吞吐量、内置分区、支持消息副本和高容 错的特性，非常适合大规模消息处理应用程序。</p>
<img src="https://img-blog.csdnimg.cn/20201025100102289.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVyaW9ycGVuZ0ZpZ2h0,size_16,color_FFFFFF,t_70" alt="img" style="zoom: 67%;" />

<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>用户的活动追踪</li>
</ul>
<p>用户在网站的不同活动消息发布到不同的主题中心，然后可以对这些消息进行实时监测实时处理。当然，也可加载到 Hadoop 或离线处理数据仓库，对用户进行画像。像淘宝、京东这些大型的电商平台，用户的所有活动都是要进行追踪的。</p>
<ul>
<li><p>日志聚合<br><img src="https://img-blog.csdnimg.cn/20201025100208271.png" alt="img"></p>
</li>
<li><p>限流削峰<br><img src="https://img-blog.csdnimg.cn/20201025100319668.png" alt="img"></p>
</li>
</ul>
<h2 id="kafka-高吞吐率实现"><a href="#kafka-高吞吐率实现" class="headerlink" title="kafka 高吞吐率实现"></a><strong>kafka</strong> 高吞吐率实现</h2><p>Kafka 与其它 MQ 相比，其最大的特点就是高吞吐率。为了增加存储能力，Kafka 将所有 的消息都写入到了低速大容的硬盘。按理说，这将导致性能损失，但实际上，kafka 仍可保 持超高的吞吐率，性能并未受到影响。其主要采用了如下的方式实现了高吞吐率。</p>
<ul>
<li><p>顺序读写:Kafka将消息写入到了分区partition中，而分区中消息是顺序读写的。顺序</p>
<p>读写要远快于随机读写。</p>
</li>
<li><p>零拷贝:生产者、消费者对于kafka中消息的操作是采用零拷贝实现的，即不经过操作系统的ALU，不经过用户空间，消息直接写入内核。<!--见Ngnix中对零拷贝的讲解--></p>
</li>
<li><p>批量发送:Kafka允许使用批量消息发送模式。</p>
</li>
<li><p>消息压缩:Kafka支持对消息集合进行压缩。</p>
</li>
</ul>
<h1 id="Kafka-工作原理与工作过程"><a href="#Kafka-工作原理与工作过程" class="headerlink" title="Kafka 工作原理与工作过程"></a><strong>Kafka</strong> 工作原理与工作过程</h1><blockquote>
<p>思考：</p>
<ol>
<li><p>如果集群中topic只有一个partition，那么如果client端连接上其他server，可以删除这个topic吗？</p>
<ul>
<li>肯定是可以的。因为其他server会路由到Controller sever, 然后Controller server知道这个topic下的partition位于哪台server中。</li>
</ul>
</li>
<li><p>对于集群，哪些是client，哪些是server?区别是什么？</p>
<ul>
<li>consumer和producer都是client, 他们都不需要启动，只需要运行脚本文件就可以了。kafka集群是server，必须启动运行。</li>
</ul>
</li>
<li><p>Kafka集群和Redis集群有什么区别？</p>
<ul>
<li>kafka集群是连接到zk上的，topic信息都是zk存储；Redis集群是自己管理，每个节点都会存储其他节点的信息。</li>
</ul>
</li>
</ol>
</blockquote>
<p><a href="">kafka本身即是server，又是client，体现如下</a></p>
<blockquote>
<ul>
<li>创建topic的时候，链接zookeeper的时候，需要启动kafka，表明现在kafka就是一个server</li>
<li>向topic发送消息的时候，可以不启动kafka，直接使用bin/kafka-console-producer.sh –topic quickstart-events命令，表明现在kafka就是一个client</li>
<li>从topic接收消息的时候，同样也可以不用启动kafka</li>
</ul>
</blockquote>
<h2 id="Kafka-基本术语"><a href="#Kafka-基本术语" class="headerlink" title="Kafka 基本术语"></a><strong>Kafka</strong> 基本术语</h2><h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a><strong>Topic</strong></h3><p>主题。在 Kafka 中，使用一个类别属性来划分消息的所属类，划分消息的这个类称为 topic。 topic 相当于消息的分类标签，是一个逻辑概念。<!--其他MQ也有--></p>
<p>位置：<a href="">tmp/kafka-logs/[topic]-[partition]</a></p>
<h3 id="Partition"><a href="#Partition" class="headerlink" title="Partition"></a><strong>Partition</strong></h3><p>分区。topic 中的消息被分割为一个或多个 partition，其是一个物理概念，对应到系统上 就是一个或若干个目录。<!--其他MQ没有--></p>
<p>位置：<a href="">tmp/kafka-logs/[topic]-[partition]</a><!--如果是集群，每个broker的partition不同，是递增关系--></p>
<p>数量：一般为broker的整数倍，否则负载不均衡</p>
<blockquote>
<p>逻辑结构                              实际目录</p>
<p>Topic=test</p>
<p>​                partitions   </p>
<p>​                0                            broker0：tmp/kafka-logs/test-0</p>
<p>​                1                            broker1：tmp/kafka-logs/test-1</p>
<p>​                2                            broker2：tmp/kafka-logs/test-2</p>
</blockquote>
<h3 id="segment"><a href="#segment" class="headerlink" title="segment"></a><strong>segment</strong></h3><p>段。将 partition 进一步细分为了若干的 segment，每个 segment 文件的最大大小相等。两部分组成，“. Index” file 和 “.log” file, 分别对应的是segment index file and data file.</p>
<ul>
<li>.log file从 000.0000.log开始，数据满了，增加另一个log file。</li>
</ul>
<p>位置：<a href="">tmp/kafka-logs/[topic]-[partition]</a>目录下的<a href="">xxx（20位bit）.log</a>文件和[xxx（20位bit）.index</p>
<!--kafka顺序写，指的是partition有序-->

<p><a href="">20bit</a>的意思是表示该segment之前有多少条消息，比如第一个segment名称为0000…000.log (有2500条)，那么下一个segment名称为000.0002500.log(1000条)</p>
<img src="https://miro.medium.com/max/1608/0*SIY8Kt3Y74tysckC.png" alt="Image for post" style="zoom: 50%;" />

<blockquote>
<p>比如，一个consumer要消费，手里有消息id（000..170414）,如何在broker中找到该消息吗？</p>
<ul>
<li><p>broker中的partition有大量segment，根据二分法查找这些segment中名称最接近000..170414的，000..170410.log</p>
</li>
<li><p>那么offset = 4, 再通过000..170410.index的偏移量4与映射关系找到000..170414这个消息在磁盘中的位置。完成</p>
</li>
</ul>
</blockquote>
<h3 id="Broker"><a href="#Broker" class="headerlink" title="Broker"></a><strong>Broker</strong></h3><p>Kafka 集群包含多个服务器，每个服务器节点称为一个 broker。 一个 topic 中设置 partition 的数量是 broker 数量的整数倍。</p>
<h3 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a><strong>Producer</strong></h3><p>生产者。即消息的发布者，其会将某 topic 的消息发布到相应的 partition 中。</p>
<h3 id="Consumer-Group"><a href="#Consumer-Group" class="headerlink" title="Consumer Group"></a><strong>Consumer Group</strong></h3><p>消费者。可以从 broker 中读取消息，其是以 consumer group 的形式出现的。</p>
<ul>
<li><p>consumer group 是 kafka 提供的可扩展且具有容错性的消费者机制。组内可以有多个消 费者，它们共享一个公共的 ID，即 group ID。<a href="">组内的所有消费者会协调在一起平均消费订阅主题的所有分区</a>。</p>
<p>Kafka 可以保证在稳定状态下，<a href="">一个 partition 中的消息只能被同一个 consumer group 中 的一个 consumer 消费，不能被多个consumer消费</a>，而<a href="">一个组内 consumer 只会消费某一个或几个特定的 partition</a>。当然， 一个消息可以同时被多个 consumer group 消费。</p>
</li>
<li><p>组中 consumer 数量与 partition 数量的对应关系如下。</p>
<ul>
<li><img src="https://www.oreilly.com/library/view/kafka-the-definitive/9781491936153/assets/ktdg_04in01.png" alt="4 partition, 1 consumer" style="zoom: 25%;" />
</li>
<li><img src="https://www.oreilly.com/library/view/kafka-the-definitive/9781491936153/assets/ktdg_04in02.png" alt="ktdg 04in02" style="zoom: 25%;" />
</li>
<li><img src="https://www.oreilly.com/library/view/kafka-the-definitive/9781491936153/assets/ktdg_04in03.png" alt="ktdg 04in03" style="zoom: 25%;" /></li>
<li><img src="https://www.oreilly.com/library/view/kafka-the-definitive/9781491936153/assets/ktdg_04in04.png" alt="ktdg 04in04" style="zoom:25%;" /></li>
<li><img src="https://www.oreilly.com/library/view/kafka-the-definitive/9781491936153/assets/ktdg_04in05.png" alt="ktdg 04in05" style="zoom:25%;" />

<p>这样设计的优点:实现简单、控制简单。不足:consumer 对于消息的消费不均衡，注意，不是对 partition 分配的不均衡。</p>
</li>
</ul>
</li>
</ul>
<h3 id="Replicas-of-partition"><a href="#Replicas-of-partition" class="headerlink" title="Replicas of partition"></a><strong>Replicas of partition</strong></h3><p>分区副本。副本是一个分区的备份，是为了防止消息丢失而创建的分区的备份。</p>
<p>只允许挂replicas-1台机器</p>
<h3 id="Partition-Leader-与-Partition-Follower"><a href="#Partition-Leader-与-Partition-Follower" class="headerlink" title="Partition Leader 与 Partition Follower"></a><strong>Partition Leader</strong> 与 Partition Follower</h3><ul>
<li>每个 partition 有多个副本replicas，<!--这块我经常混淆，以为topic-partition-0、topic-partition-1....互为副本 --> 其中有且仅有一个作为 Leader，Leader 是当前负责消息读写 的 partition。<a target="_blank" rel="noopener" href="http://dpurl.cn/HxIrgGcz">即所有读写操作只能发生于 Leader 分区上。</a></li>
<li>所有 Follower 都需要从 Leader 同步消息，Follower 与 Leader 始终保持消息同步。 partition leader 与 partition follower 是主备关系，不是主从。<ul>
<li>主备：主干活，从不干活。除非主挂了</li>
<li>主从：主干活，从业干活，但是一般读写分离</li>
</ul>
</li>
</ul>
<h3 id="ISR"><a href="#ISR" class="headerlink" title="ISR"></a><strong>ISR</strong></h3><img src="https://miro.medium.com/max/2074/0*EKINPKA_r9-9ip5k.png" alt="Image for post" style="zoom:67%;" />

<p>ISR，In-Sync Replicas，是指partition副本同步列表。<br>AR，Assiged Replicas，是指所有partition副本。<br>OSR，Outof-Sync Replicas，是同步超时的partition副本。leader和follower通信超时，那么follower进入OSR<br>AR = ISR + OSR</p>
<h3 id="offset"><a href="#offset" class="headerlink" title="offset"></a><strong>offset</strong></h3><p>偏移量。每条消息都有一个当前 Partition 下唯一的 64 字节的 offset，它是相对于当前 分区第一条消息的偏移量。</p>
<h3 id="offset-commit"><a href="#offset-commit" class="headerlink" title="offset commit"></a><strong>offset commit</strong></h3><p>当 consumer 从 partition 中消费了消息后，consumer 会将其消费的消息的 offset 提交给 broker，表示当前 partition 已经消费到了该 offset 所标识的消息。</p>
<p>Consumer 从 partition 中取出一批消息写入到 buffer 对其进行消费，在规定时间内消费 完消息后，会自动将其消费消息的 offset 提交给 broker，以让 broker 记录下哪些消息是消费 过的。当然，若在时限内没有消费完毕，其是不会提交 offset 的。</p>
<h3 id="Rebalance"><a href="#Rebalance" class="headerlink" title="Rebalance"></a><strong>Rebalance</strong></h3><p>当消费者组中消费者数量发生变化，或 Topic 中的 partition 数量发生了变化时，partition 的所有权会在消费者间转移，即 partition 会重新分配，这个过程称为再均衡 Rebalance。</p>
<p>再均衡能够给消费者组及 broker 集群带来高可用性和伸缩性，但在再均衡期间消费者 是无法读取消息的，即整个 broker 集群有一小段时间是不可用的。因此要避免不必要的再 均衡。</p>
<h3 id="consumer-offsets"><a href="#consumer-offsets" class="headerlink" title="__consumer_offsets"></a><strong>__consumer_offsets</strong></h3><p>消费者提交的 offset 被封装为了一种特殊的消息被写入到了一个由系统创建的、名称为 __consumer_offset 的特殊topic的 partitions 中了。该 Topic 默认包含 50 个分区。<a href="">在partition中的offset默认有效期为一天</a><!--如果两次消费中间隔了一天，那么offset就失效了，悲剧了，哈哈！不过，这种场景不会发生在生产中--></p>
<p>每个 Consumer Group 的消费的 offset 都会被记录在__consumer_offsets 主题的 partition 中。该主题的 partition 默认有 50 个，那么 Consumer Group 消费的 offset 存放在哪个分区呢? 其有计算公式:<a href="">Math.abs(groupID.hashCode()) % 50</a>。<!--也就是同一个groupID,永远用的同一个partition--></p>
<p>写入到__consumer_offsets 主题的 partition 中的 offset 消息格式为:<br><font color="color">[Group, Topic, Partition]::[OffsetMetadata[Offset, Metadata], CommitTime, ExpirationTime]</font></p>
<ul>
<li><p><strong>Broker Controller</strong></p>
<p>Kafka 集群的多个 broker 中，有一个会被选举为 controller，负责管理整个集群中 partition 和副本 replicas 的状态。</p>
</li>
<li><p><strong>Zookeeper</strong></p>
<p>Zookeeper 负责维护和协调 broker，负责 Broker Controller 的选举。 </p>
</li>
<li><p><strong>Group Coordinator</strong></p>
<p>group Coordinator 是运行在每个 broker 上的进程，主要用于 Consumer Group 中的各个 成员的 offset 位移管理和 Rebalance。Group Coordinator 同时管理着当前 broker 的所有消费 者组。</p>
</li>
</ul>
<h3 id="Broker-Controller"><a href="#Broker-Controller" class="headerlink" title="Broker Controller"></a><strong>Broker Controller</strong></h3><p>Kafka 集群的多个 broker 中，有一个会被选举为 controller，负责管理整个集群中 partition 和副本 replicas 的状态。</p>
<h3 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h3><p>Zookeeper 负责维护和协调 broker，负责 Broker Controller 的选举。 总结:</p>
<ul>
<li>partition leader是broker controller选举出来的</li>
<li>broker controller是zk选举出来的</li>
</ul>
<h3 id="Group-Coordinator"><a href="#Group-Coordinator" class="headerlink" title="Group Coordinator"></a>Group Coordinator</h3><p>group Coordinator 是运行在每个 broker 上的进程，主要用于 Consumer Group 中的各个 成员的 offset 位移管理和 Rebalance。Group Coordinator 同时管理着当前 broker 的所有消费 者组。</p>
<blockquote>
<p>当 Consumer 发送请求要消费数据时，当前 broker并不是直接从__consumer_offset 的 partition 中获取的， 而是从当前 broker 的 Coordinator 的缓存中获取的。<!--因为partition是在磁盘中，读取效率低--></p>
</blockquote>
<blockquote>
<p>缓存中的数据从哪里来呢?</p>
<p>当 Consumer 消费完毕提交 offset 时，会同时提交到当前 broker的coordinator 的缓存__consumer_offset 的 partition。</p>
</blockquote>
<h2 id="Kafka工作原理与过程"><a href="#Kafka工作原理与过程" class="headerlink" title="Kafka工作原理与过程"></a>Kafka工作原理与过程</h2><h3 id="生产者消息路由策略"><a href="#生产者消息路由策略" class="headerlink" title="生产者消息路由策略"></a>生产者消息路由策略</h3><p>在通过 API 方式发布消息时，生产者是以 Record 为消息进行发布的。Record 中包含 key 与 value，value 才是我们真正的消息本身，而 key 用于路由消息所要存放的 Partition。消息 要写入到哪个 Partition 并不是随机的，而是有路由策略的。</p>
<ol>
<li><p>若指定了 partition，则直接写入到指定的 partition;</p>
</li>
<li><p>若未指定 partition 但指定了 key，则通过对 key 的 hash 值与 partition 数量取模，该取模结果就是要选出的 partition 索引;</p>
</li>
<li><p>若 partition 和 key 都未指定，则使用轮询算法选出一个 partition。</p>
</li>
</ol>
<h3 id="生产者消息写入算法"><a href="#生产者消息写入算法" class="headerlink" title="生产者消息写入算法"></a>生产者消息写入算法</h3><p>生产者将消息发送给 broker，并形成最终的可供消费者消费的 log，是一个比较复 杂的过程。</p>
<ol>
<li><p>producer 向 broker 集群提交连接请求，其所连接上的任意 broker 都会向其发送 broker controller 的通信 URL，即 broker controller 主机配置文件中的 listeners 地址  <!--任意 broker为什么知道broker controller 的通信 URL呢？因为broker都是zk的客户端--></p>
</li>
<li><p>当 producer 指定了要生产消息的 topic 后，其会向 broker controller 发送请求，请求当前 topic 中所有 partition 的 leader 列表地址</p>
</li>
<li><p>broker controller 在接收到请求后，会从 zk 中查找到指定 topic 的所有 partition 的 leader， 并返回给 producer</p>
</li>
<li><p>producer 在接收到 leader 列表地址后，根据消息路由策略找到当前要发送消息所要发送 的 partition leader，然后将消息发送给该 leader</p>
</li>
<li><p>leader 将消息写入本地 xxxx.log file，并通知 ISR 中的 followers</p>
</li>
<li><p>ISR 中的 followers 从 leader 中同步消息后向 leader 发送 ACK</p>
</li>
<li><p>leader 收到所有 ISR 中的 followers 的 ACK 后，增加 HW，表示消费者已经可以消费到该位置了</p>
</li>
</ol>
<ul>
<li>当然，若 leader 在等待的 followers 的 ACK 超时了，发现还有 follower 没有发送 ACK，则会将这些没有发送 ACK 的 follower 从 ISR 中清除，然后再增加 HW</li>
</ul>
<h3 id="HW-机制（面试重点）"><a href="#HW-机制（面试重点）" class="headerlink" title="HW 机制（面试重点）"></a><strong>HW</strong> 机制（面试重点）</h3><p>HW，HighWatermark，高水位，表示 Consumer 可以消费到的最高 partition 偏移量。HW 保证了 Kafka 集群中消息的一致性。确切地说，是在 broker <a href="">集群正常运转</a>的状态下，保证了 partition 的 Follower 与 Leader 间数据的一致性。</p>
<p>LEO，Log End Offset，日志最后消息的偏移量。消息是被写入到 Kafka 的日志文件中的， 这是当前最后一个写入的消息在 Partition 中的偏移量。</p>
<p>对于 leader 新写入的消息，consumer 是不能立刻消费的。leader 会等待该消息被所有 ISR 中的 partition follower 同步后才会更新 HW，此时消息才能被 consumer 消费。</p>
<p><font color='red'>就是消费者可以消费的消息，由HW决定的</font></p>
<p><img src="https://miro.medium.com/max/2096/0*lLqhkK6YUVb0LBr_.png" alt="Image for post"></p>
<h3 id="HW-截断机制"><a href="#HW-截断机制" class="headerlink" title="HW 截断机制"></a><strong>HW</strong> 截断机制</h3><p>如果 partition leader 接收到了新的消息， ISR 中其它 Follower 正在同步过程中，<a href="">还未同步完毕时 leader 挂了,</a>此时就需要选举出新的 leader。若没有 HW 截断机制，将会导致 partition 中 leader 与 follower 数据的不一致。</p>
<p><a href="">当原 leader 宕机后又恢复时，将其 LEO 回退到其宕机时的 HW，然后再与新的 leader 进行数据同步，这种机制称为 HW 截断机制。</a></p>
<p>HW 截断机制可能会引发消息的丢失。</p>
<blockquote>
<p>但是如何保证消息不丢呢？请看下面</p>
</blockquote>
<h3 id="生产者消息发送的可靠性机制"><a href="#生产者消息发送的可靠性机制" class="headerlink" title="生产者消息发送的可靠性机制"></a>生产者消息发送的可靠性机制</h3><p>生产者向 kafka 发送消息时，可以选择需要的可靠性级别。通过 acks 参数的值进行设置。</p>
<p>(<strong>1</strong>) <strong>0</strong> 值</p>
<p>异步发送。生产者向 kafka 发送消息而不需要 kafka 反馈成功 ack。该方式效率最高，但可靠性最低。其可能会存在消息丢失的情况。</p>
<p>(<strong>2</strong>) <strong>1</strong> 值</p>
<p>同步发送，默认值。生产者发送消息给 kafka，broker 的 <a href="">partition leader 在收到消息后</a>马上发送成功 ack(follower 是否同步完成，不影响 ack 的发送)，生产者收到后才会再发送 消息。如果一直未收到 kafka 的 ack，则生产者会认为消息发送失败，会重发消息。</p>
<ul>
<li>该策略能否使生产者确认其发送的消息成功?不能。<br>生产者即使收到了 ack，也不一定 就被 kafka 成功接收了。<!--比如leader收到后正在对follwers同步当中，宕机，然后根据[HW截断机制]()，该消息丢了。--></li>
<li>该策略能否使生产者确认其发送的消息失败?可以。<br>只要生产者没有收到 ack，消息发 送一定失败。</li>
</ul>
<p>(<strong>3</strong>) <strong>-1</strong> 值</p>
<p>同步发送。其值等同于 all。生产者发送消息给 kafka，kafka 收到消息后要等到 <a href="">ISR 列表中的所有副本</a>都同步消息完成后，<a href="">才向生产者发送成功 ack</a>。如果一直未收到 kafka 的 ack， 则认为消息发送失败，会自动重发消息。</p>
<p>该模型可靠性最高，很少出现消息丢失的情况。<!--比如producer批量发送的时候，缓存满了，数据无法进入缓存，导致发送出差--></p>
<p>但可能会出现部分 follower <a href="">重复接收</a>消息的情况(不是<a href="">重复消费</a>)。<!--比如leader同步过程中宕机，则生产者没有收到ack，那么生产者重复数据，导致follower又接收一样的数据--></p>
<h3 id="消费者消费过程和offset"><a href="#消费者消费过程和offset" class="headerlink" title="消费者消费过程和offset"></a>消费者消费过程和offset</h3><p>生产者将消息发送到 topic 中，消费者即可对其进行消费，其消费过程如下:</p>
<h4 id="消息重定向"><a href="#消息重定向" class="headerlink" title="消息重定向"></a><strong>消息重定向</strong></h4><ol>
<li><p>consumer 向 broker 集群提交连接请求，其所连接上的任意 broker 都会向其发送 broker controller 的通信 URL，即 broker controller 主机配置文件中的 listeners 地址</p>
</li>
<li><p>当 consumer 指定了要消费的 topic 后，其会向 broker controller 发送 poll 请求</p>
</li>
<li><p>broker controller 会为 consumer 分配一个或几个 partition leader <!--比如3个broker有3个partition，那么有3个partition Leader;若有2个consumer，1个consumer分配一个Leader，另1个consumer分配2个Leader-->，并将该 partitioin 的当前 offset 发送给 consumer</p>
</li>
</ol>
<blockquote>
<p> a record gets delivered to only one consumer in a consumer group.</p>
</blockquote>
<ol start="4">
<li>consumer 会按照 broker controller 分配的 partition 对其中的消息进行消费</li>
</ol>
<img src="https://www.sderosiaux.com/static/044d8e05febd37679ba9b3c1bd82c1f2/00d43/consuming.png" alt="hop" style="zoom:67%;" />

<h4 id="消费者确认收到"><a href="#消费者确认收到" class="headerlink" title="消费者确认收到"></a><strong>消费者确认收到</strong></h4><ol start="5">
<li>当消费者消费完该条消息后，消费者会向 broker 发送一个该消息已被消费的反馈，即该消息的 offset</li>
</ol>
<h4 id="集群更新该group的offset"><a href="#集群更新该group的offset" class="headerlink" title="集群更新该group的offset"></a>集群更新该group的offset</h4><ol start="6">
<li>当 broker 接到消费者的 offset 后，会更新到相应的__consumer_offset 中</li>
</ol>
<blockquote>
<p> one of the brokers is designated as the group’s <strong>coordinator</strong> and is responsible for managing the members of the group as well as their partition assignments. <!--就是说group的offset交给某一个partition的broker来管理，并且_consumer_offsets_partition作为特殊的topic，也是有leader partition（位于不同broker）的--></p>
<p>The coordinator of each group is chosen from the leaders of the internal offsets topic <code>__consumer_offsets</code>, which is used to store committed offsets. Basically <a href="">the group’s ID is hashed to one of the partitions for this topic</a> and <a href="">the leader of that partition is selected as the coordinator</a>. In this way, management of consumer groups is divided roughly equally across all the brokers in the cluster, which allows the number of groups to scale by increasing the number of brokers.</p>
<p>When the consumer starts up, it finds the coordinator for its group and sends a request to join the group. The coordinator then begins a group rebalance so that the new member is assigned its fair share of the group’s partitions. Every rebalance results in a new <strong>generation</strong> of the group.</p>
</blockquote>
<blockquote>
<p>consumers groups each have their own offset per partition. 所以说有多少个partition，这个group就有多少个对应的offset</p>
<p>the consumer groups have their own offset for every partition in the topic which is unique to what other consumer groups have.</p>
</blockquote>
<h4 id="重复过程，并压缩日志"><a href="#重复过程，并压缩日志" class="headerlink" title="重复过程，并压缩日志"></a>重复过程，并压缩日志</h4><ol start="7">
<li>以上过程一直重复，直到消费者停止请求消息</li>
</ol>
<blockquote>
<p>kafka stores offset data in a topic called <code>&quot;__consumer_offset&quot; </code>. these topics use log compaction, which means they only save the most recent value per key. 就是类似于Redis的AOF压缩技术，只保存最新的value</p>
</blockquote>
<ol start="8">
<li>消费者可以重置 offset，从而可以灵活消费存储在 broker 上的消息</li>
</ol>
<h3 id="消费者重复消费问题及解决方案"><a href="#消费者重复消费问题及解决方案" class="headerlink" title="消费者重复消费问题及解决方案"></a>消费者重复消费问题及解决方案</h3><p>最常见的重复消费有两种:</p>
<p>(<strong>1</strong>) 同一个 <strong>consumer</strong> 重复消费</p>
<p>当 Consumer 由于消费能力较低而引发了消费超时时，则可能会形成重复消费。<!--比如consumer在1s内没有消费完指定的500条消息，consumer不会向broker提交offset,而是会发送error，那么broker会从原来的offset再发送原来的500条，导致consumer重复发送--></p>
<p>解决方案:可以减少读取的消息个数，也可以延长自动提交的时间，还可以将自动提交转变为手动提交(consumer.commitSyn()方法)。</p>
<p>(<strong>2</strong>) 不同的 <strong>consumer</strong> 重复消费</p>
<p>当 Consumer 消费了消息但还未提交 offset 时宕机，则这些已被消费过的消息会被重复。<!--比如2个同组的consumer, 1st consumer挂了，未提交offset,那么rebalance后，2nd consumer会继续消费1st consumer原来对应partition中的数据--></p>
<p>解决方案: 没办法绝对避免，可以通过对每个数据都要手动提交从而减少重复的数量</p>
<h3 id="集群Partition-Leader-选举范围"><a href="#集群Partition-Leader-选举范围" class="headerlink" title="集群Partition Leader 选举范围"></a><strong>集群Partition Leader</strong> 选举范围</h3><p>当 leader 挂了后 broker controller 会从 ISR 中选一个 follower 成为新的 leader。但，若 ISR 中的所有副本都挂了怎么办?</p>
<p>可以通过 unclean.leader.election.enable 的取值来设置 Leader 选举的范围。</p>
<p>(<strong>1</strong>) <strong>false</strong></p>
<p>必须等待 ISR 列表中有副本活过来才进行新的选举。该策略可靠性有保证，但可用性低。</p>
<p>(<strong>2</strong>) <strong>true</strong> </p>
<p>在 ISR 中没有副本的情况下可以选择任何一个该 Topic 的 partition 作为新的 leader，该策略可用性高，但可靠性没有保证。可能会引发大量的消息丢失。<!--不推荐用,但是kafka用在日志系统比较多，所以丢了--></p>
<h2 id="kafka-操作"><a href="#kafka-操作" class="headerlink" title="kafka 操作"></a><strong>kafka</strong> 操作</h2><blockquote>
<p><a href="">强调：kafka的操作，只要连到任意一个集群中的broker就行，最终都会路由的由controller，因为是zk管理的</a></p>
</blockquote>
<h3 id="启动-关闭kafka"><a href="#启动-关闭kafka" class="headerlink" title="启动/关闭kafka"></a>启动/关闭kafka</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-start.sh config/server.properties #启动kafka</span><br><span class="line"></span><br><span class="line">bin/kafka-server-stop.sh  #关闭kafka</span><br></pre></td></tr></table></figure>



<h3 id="创建-topic"><a href="#创建-topic" class="headerlink" title="创建 topic"></a>创建 <strong>topic</strong></h3><blockquote>
<p>partitions数量最好是与kafka server数量一致</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-topics.sh --create --bootstrap-server 192.168.59.152:9092 --replication-factor 1 --partitions 1 --topic test_topic <span class="comment">#分区数量是1，1个备份（replication）</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll tmp&#x2F;logs  ##查看刚才创建的主题, 只有一个server有test_topic-0</span><br></pre></td></tr></table></figure>

<p>partitions参数</p>
<ul>
<li><font color="red">如果partitions &lt; server，比如partitions=1, 那么只有一个server有test_topic，即test_topic-0</font></li>
<li><font color="red">如果partitions = server，那么每个server都有test_topic，即test_topic-0, test_topic-1 ….</font></li>
</ul>
<p>replication参数</p>
<ul>
<li><font color="red">如果replication=1，那么整个kafka集群，只有一个server含有test_topic的一个备份</font></li>
</ul>
<h3 id="查看-topic"><a href="#查看-topic" class="headerlink" title="查看 topic"></a>查看 <strong>topic</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-topics.sh --list --bootstrap-server 192.168.59.153:9092 <span class="comment">##无所谓连接哪个bootstrap-server，因为是集群</span></span></span><br></pre></td></tr></table></figure>

<h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><p>该命令会创建一个生产者，然后由其生产消息,发送给topic。</p>
<blockquote>
<p>–bootstrap-server 随意一个kafka server，因为broker内部有controller，会将信息进行发送给topic</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-producer.sh --topic topic_test --bootstrap-server 192.168.59.153:9092</span></span><br></pre></td></tr></table></figure>

<h3 id="消费消息"><a href="#消费消息" class="headerlink" title="消费消息"></a>消费消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/kafka-console-consumer.sh --topic topic_test --from-beginning --bootstrap-server 192.168.59.153:9092</span><br></pre></td></tr></table></figure>

<ul>
<li>–from-beginning：表示从头开始消费，否则只能消费新的消息。</li>
</ul>
<h3 id="继续生产消费"><a href="#继续生产消费" class="headerlink" title="继续生产消费"></a>继续生产消费</h3><h3 id="删除-topic"><a href="#删除-topic" class="headerlink" title="删除 topic"></a>删除 <strong>topic</strong></h3><blockquote>
<p>–bootstrap-server 随意一个kafka server，即便这个server没有存储该topic的partition，因为broker内部有controller，会将信息进行发送给controller，然后由controller定位到含有topic partition的server，进行删除</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-topics.sh --delete --bootstrap-server 192.168.59.152:9092 --topic topic_test </span></span><br></pre></td></tr></table></figure>

<h2 id="zk操作"><a href="#zk操作" class="headerlink" title="zk操作"></a>zk操作</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkCli.sh #进入zk命令行</span><br></pre></td></tr></table></figure>

<h3 id="查看目录信息"><a href="#查看目录信息" class="headerlink" title="查看目录信息"></a>查看目录信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /</span><br><span class="line">[admin, brokers, cluster, config, consumers, controller, controller_epoch, feature, isr_change_notification, latest_producer_id_block, log_dir_event_notification, zookeeper]</span><br></pre></td></tr></table></figure>

<h3 id="查看kafka集群的broker"><a href="#查看kafka集群的broker" class="headerlink" title="查看kafka集群的broker"></a>查看kafka集群的broker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ls /</span><br><span class="line">[admin, brokers, cluster, config, consumers, controller, controller_epoch, feature, isr_change_notification, latest_producer_id_block, log_dir_event_notification, zookeeper]</span><br><span class="line"></span><br><span class="line">ls /brokers </span><br><span class="line">[ids, seqid, topics]</span><br><span class="line"></span><br><span class="line">ls /brokers/ids #当时给broker配置的broker.id</span><br><span class="line">[0, 1, 3]</span><br><span class="line"></span><br><span class="line">get /brokers/ids/0 #查看broker.id=0的broker信息</span><br><span class="line">&#123;&quot;listener_security_protocol_map&quot;:&#123;&quot;PLAINTEXT&quot;:&quot;PLAINTEXT&quot;&#125;,&quot;endpoints&quot;:[&quot;PLAINTEXT://192.168.199.134:9092&quot;],&quot;jmx_port&quot;:-1,&quot;features&quot;:&#123;&#125;,&quot;host&quot;:&quot;192.168.199.134&quot;,&quot;timestamp&quot;:&quot;1615489355496&quot;,&quot;port&quot;:9092,&quot;version&quot;:5&#125;</span><br></pre></td></tr></table></figure>



<h3 id="查看kafka集群的topic"><a href="#查看kafka集群的topic" class="headerlink" title="查看kafka集群的topic"></a>查看kafka集群的topic</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls /brokers/topics</span><br><span class="line"></span><br><span class="line">get /brokers/topics/cities/partitions/0 #可以看到isr、leader信息</span><br></pre></td></tr></table></figure>



<h3 id="删除topic"><a href="#删除topic" class="headerlink" title="删除topic"></a>删除topic</h3><blockquote>
<p>rmr (deprecated) or deleteall</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">找到要删除的topic，然后执行命令，此时topic被彻底删除</span></span><br><span class="line">rmr /brokers/topics/【topic name】</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">如果topic 是被标记为 marked <span class="keyword">for</span> deletion，则通过命令 ls /admin/delete_topics，找到要删除的topic，然后执行命令：</span></span><br><span class="line">rmr /admin/delete_topics/【topic name】</span><br></pre></td></tr></table></figure>



<h1 id="日志查看"><a href="#日志查看" class="headerlink" title="日志查看"></a>日志查看</h1><p>我们这里说的日志不是 Kafka 的启动日志，启动日志在 Kafka 安装目录下的 logs/server.log 中。消息在磁盘上都是以日志的形式保存的。我们这里说的日志是存放在/tmp/kafka_logs 目录中的消息日志，即 partition 与 segment</p>
<h2 id="查看topic的分区partition与备份Replicas"><a href="#查看topic的分区partition与备份Replicas" class="headerlink" title="查看topic的分区partition与备份Replicas"></a>查看topic的分区partition与备份Replicas</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls &#x2F;tmp&#x2F;kafka_logs</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看到<a href="">topic-主机分区号</a>，如果备份=主机数量，此主机还有<a href="">topic-其他主机分区号</a></li>
</ul>
<h3 id="1-个分区-1-个备份"><a href="#1-个分区-1-个备份" class="headerlink" title="1 个分区 1 个备份"></a>1 <strong>个分区</strong> <strong>1</strong> <strong>个备份</strong></h3><p>我们前面创建的 test 主题是 1 个分区 1 个备份。<a href="">发现只有1个broker含有test-0</a></p>
<table>
<thead>
<tr>
<th>broker</th>
<th>topic-partition</th>
</tr>
</thead>
<tbody><tr>
<td>broker1</td>
<td>test-0</td>
</tr>
<tr>
<td>broker2</td>
<td>null</td>
</tr>
<tr>
<td>broker3</td>
<td>null</td>
</tr>
</tbody></table>
<h3 id="3-个分区-1-个备份"><a href="#3-个分区-1-个备份" class="headerlink" title="3 个分区 1 个备份"></a><strong>3</strong> <strong>个分区</strong> <strong>1</strong> 个备份</h3><p>再次创建一个主题，命名为 one，创建三个分区，但仍为一个备份。 依次查看三台broker，可以看到<a href="">每台 broker 中都有一个 one 主题的分区，分别为one-0, one-1, one-2。</a></p>
<table>
<thead>
<tr>
<th>broker</th>
<th>topic-partition</th>
</tr>
</thead>
<tbody><tr>
<td>broker1</td>
<td>one-0</td>
</tr>
<tr>
<td>broker2</td>
<td>one-1</td>
</tr>
<tr>
<td>broker3</td>
<td>one-2</td>
</tr>
</tbody></table>
<h3 id="3-个分区-2-个备份"><a href="#3-个分区-2-个备份" class="headerlink" title="3 个分区 2 个备份"></a><strong>3</strong> <strong>个分区</strong> 2 个备份</h3><p>再次创建一个主题，命名为 p3r2，创建三个分区，2个备份。依次查看三台 broker，可以看到每台 broker 中都有2份 two 主题的分区。</p>
<table>
<thead>
<tr>
<th>broker</th>
<th>topic-partition</th>
</tr>
</thead>
<tbody><tr>
<td>broker1</td>
<td>p3r2-0, p3r2-1</td>
</tr>
<tr>
<td>broker2</td>
<td>p3r2-0, p3r2-2</td>
</tr>
<tr>
<td>broker3</td>
<td>p3r2-1, p3r2-2</td>
</tr>
</tbody></table>
<h3 id="3-个分区-3-个备份"><a href="#3-个分区-3-个备份" class="headerlink" title="3 个分区 3 个备份"></a><strong>3</strong> <strong>个分区</strong> 3 个备份</h3><p>再次创建一个主题，命名为 p3r3，创建三个分区，三个备份。依次查看三台 broker，可以看到每台 broker 中都有三份 two 主题的分区。</p>
<table>
<thead>
<tr>
<th>broker</th>
<th>topic-partition</th>
</tr>
</thead>
<tbody><tr>
<td>broker1</td>
<td>p3r3-0, p3r3-1,p3r2-2</td>
</tr>
<tr>
<td>broker2</td>
<td>p3r3-0, p3r3-1,p3r2-2</td>
</tr>
<tr>
<td>broker3</td>
<td>p3r3-0, p3r3-1,p3r2-2</td>
</tr>
</tbody></table>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>partition是尽可能的均匀分布在各个broker上，</li>
<li>replica表示整个broker所有的partition都算上，对于每一个partition都有replica个备份</li>
</ul>
<h2 id="查看特殊topic的分区"><a href="#查看特殊topic的分区" class="headerlink" title="查看特殊topic的分区"></a>查看特殊topic的分区</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /tmp/kafka_logs</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看到<a href="">__consumer_offsets 0 到 consumer_offsets 50</a>,默认50个</li>
<li>一个用户的一个主题会被提交到一个<a href="">__consumer_offsets 分区</a>中。使用主题字符串的 hash 值与 50 取模，结果即为分区索引。</li>
</ul>
<h2 id="查看段-segment"><a href="#查看段-segment" class="headerlink" title="查看段 segment"></a>查看段 <strong>segment</strong></h2><p>进入任意一个/tmp/kafka_logs/<a href="">topic-分区号</a>目录下</p>
<p>(<strong>1</strong>) <strong>segment</strong> 文件</p>
<p>segment 是一个逻辑概念，其由两类物理文件组成，分别为“.index”文件和“.log”文 件。“.log”文件中存放的是消息，而“.index”文件中存放的是“.log”文件中消息的索引。</p>
<p>(<strong>2</strong>) 查看 **segment<br>** 对于 segment 中的 log 文件，不能直接通过 cat 命令查找其内容，而是需要通过 kafka自带的一个工具查看。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-run-class.sh kafka.tools.DumpLogSegments --files </span><br><span class="line">/tmp/kafka-logs/test-0/00000000000000000000.log --print-data-log #消息里面有个payload字段，就是具体的信息</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/17/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/Distributed%20Streaming%20Platform/Kafka/kafka-%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/17/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/Distributed%20Streaming%20Platform/Kafka/kafka-%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="post-title-link" itemprop="url">kafka-消费者实现多线程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-17 08:42:46" itemprop="dateCreated datePublished" datetime="2021-03-17T08:42:46+08:00">2021-03-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-04-09 14:21:10" itemprop="dateModified" datetime="2021-04-09T14:21:10+08:00">2021-04-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://howtoprogram.xyz/2016/05/29/create-multi-threaded-apache-kafka-consumer/">https://howtoprogram.xyz/2016/05/29/create-multi-threaded-apache-kafka-consumer/</a></p>
<h2 id="Why-do-we-need-multi-thread-consumer-model"><a href="#Why-do-we-need-multi-thread-consumer-model" class="headerlink" title="Why do we need multi-thread consumer model?"></a>Why do we need multi-thread consumer model?</h2><p>Suppose we implement a notification module which allow users to subscribe for notifications from other users, other applications..Our module reads messages which will be written by other users, applications to a Kafka clusters. In this case, we can get all notifications of the others written to a Kafka topic and our module will create a consumer to subscribe to that topic.</p>
<p>Everything seems to be fine at the beginning. However, what will happen if the number of notifications produced by other applications, users…is <a href="">increased fast and exceed the rate that can be processed by our module（就是消费者集群）</a>?</p>
<p>Well, everything is still…not bad. All the messages/notifications that haven’t been processed by our module, are still in the Kafka topic. However, things get more danger when the number of messages is too much. Some of them will be lost when the retention policy is met (Note that Kafka retention policy can be time-based, partition size-based, key-based). And more important, when our notification module falls very far behind the income notifications/messages, it is not a true “notification” module anymore.</p>
<p>It’s time to think about the multi-thread consumer model.</p>
<h2 id="Multi-threaded-Apache-Kafka-consumer-model"><a href="#Multi-threaded-Apache-Kafka-consumer-model" class="headerlink" title="Multi-threaded Apache Kafka consumer model"></a>Multi-threaded Apache Kafka consumer model</h2><p>There are 2 possible models I’d like to mention in this post.</p>
<ul>
<li>Multiple consumers with their own threads (Model #1) <!--每个consumer一定在不同的JVM？不是，multi consumer体现在了执行多次new  KafkaConsumer<String, String>--></li>
<li>Single consumer, multiple worker processing threads (Model #2) <!--1个consumer在一个JVM中，JVM中包含多个线程--></li>
</ul>
<p>Both of them have their own pros and cons</p>
<h3 id="Model-1-Multiple-consumers-with-their-own-threads"><a href="#Model-1-Multiple-consumers-with-their-own-threads" class="headerlink" title="Model #1. Multiple consumers with their own threads"></a>Model #1. Multiple consumers with their own threads</h3><p><font color="red">每个线程维护一个KafkaConsumer实例</font></p>
<blockquote>
<p>multi consumer体现在了执行多次new  KafkaConsumer&lt;String, String&gt;</p>
<p>线程池的Thread各自维护一个 KafkaConsumer&lt;String, String&gt;实例</p>
</blockquote>
<p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/Model1.png" alt="Multi-threaded Apache Kafka Consumer - Multiple consumers with their own threads"></p>
<p>Multiple consumers with their own threads</p>
<table>
<thead>
<tr>
<th><strong>Pros</strong></th>
<th><strong>Cons</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Easy to implement</td>
<td><a href="">The total of consumers is limited the total partitions of the topic</a>. The redundant consumers may not be used.</td>
</tr>
<tr>
<td>Implementing in-order processing on per-partition is easier.</td>
<td><a href="">More TCP connections to the brokers</a></td>
</tr>
</tbody></table>
<h3 id="Model-2-Single-consumer-multiple-worker-processing-threads"><a href="#Model-2-Single-consumer-multiple-worker-processing-threads" class="headerlink" title="Model #2. Single consumer, multiple worker processing threads"></a>Model #2. Single consumer, multiple worker processing threads</h3><p><font color="red">维护一个KafkaConsumer（可能会有多个），同时维护多个事件处理线程(worker thread)</font></p>
<p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/model2.png" alt="Single consumer, multiple worker processing threads"></p>
<p><img src="https://images2015.cnblogs.com/blog/735367/201612/735367-20161202110008787-550483601.png" alt="img"></p>
<p>Single consumer, multiple worker processing threads</p>
<table>
<thead>
<tr>
<th><strong>Pros</strong></th>
<th><strong>Cons</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Be flexible in scale out the number of processing thread</td>
<td>It’s not easy to implement in-order processing on per partition. Let’s say there are 2 messages on the same partitions being processed by 2 different threads. To guarantee the order, those 2 threads must be coordinated somehow. <!--其实从业务角度讲，使用消息队列并不能保障有序性，都是要自己实现的--></td>
</tr>
</tbody></table>
<p>当然，这种方法还可以有多个变种：比如每个worker线程有自己的处理队列。consumer根据某种规则或逻辑将消息放入不同的队列。不过总体思想还是相同的，故这里不做过多展开讨论了。 </p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>Below is the implementation detail of both 2 models.</p>
<p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/Source-Code.png" alt="Create Multi-threaded Apache Kafka Consumer - Source Code"></p>
<h3 id="Model-1：Multiple-consumers-with-their-own-threads"><a href="#Model-1：Multiple-consumers-with-their-own-threads" class="headerlink" title="Model #1：Multiple consumers with their own threads"></a>Model #1：Multiple consumers with their own threads</h3><h4 id="Class-Diagram"><a href="#Class-Diagram" class="headerlink" title="Class Diagram"></a>Class Diagram</h4><p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/multiple2.jpg" alt="Multiple consumers with their own threads - Class Diagram"></p>
<p>Multiple consumers with their own threads – Class Diagram</p>
<p>The source code for this part includes 4 classes:</p>
<p><strong><em>NotificationProducerThread.java</em></strong> is a producer thread, produces message to the Kafka brokers</p>
<p><strong><em>NotificationConsumerThread.java</em></strong> is a consumer thread, consumes message from Kafka brokers</p>
<p><strong><em>NotificationConsumerGroup.java</em></strong> create a group of NotificationConsumerThread(s)</p>
<p><strong><em>MultipleConsumersMain.java</em></strong> contains the <strong>main</strong> method, run the program to produce and consume messages.</p>
<h4 id="NotificationProducerThread-java"><a href="#NotificationProducerThread-java" class="headerlink" title="NotificationProducerThread.java"></a>NotificationProducerThread.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.Callback;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.RecordMetadata;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationProducerThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaProducer&lt;String, String&gt; producer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationProducerThread</span><span class="params">(String brokers, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createProducerConfig(brokers);</span><br><span class="line">    <span class="keyword">this</span>.producer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createProducerConfig</span><span class="params">(String brokers)</span> </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">    props.put(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;all&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;retries&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    props.put(<span class="string">&quot;batch.size&quot;</span>, <span class="number">16384</span>);</span><br><span class="line">    props.put(<span class="string">&quot;linger.ms&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    props.put(<span class="string">&quot;buffer.memory&quot;</span>, <span class="number">33554432</span>);</span><br><span class="line">    props.put(<span class="string">&quot;key.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;value.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Produces 3 messages&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">      String msg = <span class="string">&quot;Message &quot;</span> + i;</span><br><span class="line">      producer.send(<span class="keyword">new</span> ProducerRecord&lt;String, String&gt;(topic, msg), <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(RecordMetadata metadata, Exception e)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">          System.out.println(<span class="string">&quot;Sent:&quot;</span> + msg + <span class="string">&quot;, Partition: &quot;</span> + metadata.partition() + <span class="string">&quot;, Offset: &quot;</span></span><br><span class="line">              + metadata.offset());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// closes producer</span></span><br><span class="line">    producer.close();</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When this producer thread runs, it will produces 5 messages to the broker.</p>
<h4 id="NotificationConsumerThread-java"><a href="#NotificationConsumerThread-java" class="headerlink" title="NotificationConsumerThread.java"></a>NotificationConsumerThread.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationConsumerThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaConsumer&lt;String, String&gt; consumer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationConsumerThread</span><span class="params">(String brokers, String groupId, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createConsumerConfig(brokers, groupId);</span><br><span class="line">    <span class="keyword">this</span>.consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">    <span class="keyword">this</span>.consumer.subscribe(Arrays.asList(<span class="keyword">this</span>.topic));</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createConsumerConfig</span><span class="params">(String brokers, String groupId)</span> </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">    props.put(<span class="string">&quot;group.id&quot;</span>, groupId);</span><br><span class="line">    props.put(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;auto.commit.interval.ms&quot;</span>, <span class="string">&quot;1000&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;session.timeout.ms&quot;</span>, <span class="string">&quot;30000&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      ConsumerRecords&lt;String, String&gt; records = consumer.poll(<span class="number">100</span>);</span><br><span class="line">      <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Receive message: &quot;</span> + record.value() + <span class="string">&quot;, Partition: &quot;</span></span><br><span class="line">            + record.partition() + <span class="string">&quot;, Offset: &quot;</span> + record.offset() + <span class="string">&quot;, by ThreadID: &quot;</span></span><br><span class="line">            + Thread.currentThread().getId());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When this consumer thread runs, it will poll the data from the topics or partitions.</p>
<h4 id="NotificationConsumerGroup-java"><a href="#NotificationConsumerGroup-java" class="headerlink" title="NotificationConsumerGroup.java"></a>NotificationConsumerGroup.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationConsumerGroup</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> numberOfConsumers;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String groupId;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String brokers;</span><br><span class="line">  <span class="keyword">private</span> List&lt;NotificationConsumerThread&gt; consumers;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationConsumerGroup</span><span class="params">(String brokers, String groupId, String topic,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">int</span> numberOfConsumers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.brokers = brokers;</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">    <span class="keyword">this</span>.groupId = groupId;</span><br><span class="line">    <span class="keyword">this</span>.numberOfConsumers = numberOfConsumers;</span><br><span class="line">    consumers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.numberOfConsumers; i++) &#123;</span><br><span class="line">      NotificationConsumerThread ncThread =</span><br><span class="line">          <span class="keyword">new</span> NotificationConsumerThread(<span class="keyword">this</span>.brokers, <span class="keyword">this</span>.groupId, <span class="keyword">this</span>.topic);</span><br><span class="line">      consumers.add(ncThread);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (NotificationConsumerThread ncThread : consumers) &#123;</span><br><span class="line">      Thread t = <span class="keyword">new</span> Thread(ncThread);</span><br><span class="line">      t.start();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>brokers</em></strong>: The Kafka brokers to which consumers group will connect</p>
<p><strong><em>groupId</em></strong>: The group id. All consumers on this group will have the same groupId</p>
<p><strong><em>topic</em></strong>: The topic to which the consumers group will fetch the data</p>
<p><strong><em>numberOfConsumer</em></strong>: the number of consumers will be created for the group</p>
<h4 id="MultipleConsumersMain-java"><a href="#MultipleConsumersMain-java" class="headerlink" title="MultipleConsumersMain.java"></a>MultipleConsumersMain.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MultipleConsumersMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String brokers = <span class="string">&quot;192.168.199.134:9092&quot;</span>;</span><br><span class="line">    String groupId = <span class="string">&quot;group01&quot;</span>;</span><br><span class="line">    String topic = <span class="string">&quot;HelloKafkaTopic1&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> numberOfConsumer = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (args != <span class="keyword">null</span> &amp;&amp; args.length &gt; <span class="number">4</span>) &#123;</span><br><span class="line">      brokers = args[<span class="number">0</span>];</span><br><span class="line">      groupId = args[<span class="number">1</span>];</span><br><span class="line">      topic = args[<span class="number">2</span>];</span><br><span class="line">      numberOfConsumer = Integer.parseInt(args[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start Notification Producer Thread</span></span><br><span class="line">    NotificationProducerThread producerThread = <span class="keyword">new</span> NotificationProducerThread(brokers, topic);</span><br><span class="line">    Thread t1 = <span class="keyword">new</span> Thread(producerThread);</span><br><span class="line">    t1.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start group of Notification Consumers</span></span><br><span class="line">    NotificationConsumerGroup consumerGroup =</span><br><span class="line">        <span class="keyword">new</span> NotificationConsumerGroup(brokers, groupId, topic, numberOfConsumer);</span><br><span class="line"></span><br><span class="line">    consumerGroup.execute();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">100000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This class is the entry point, contain the <strong>main</strong> method for testing our source code. In this class we will create a producer thread to produces 5 messages to the topic which has 3 partitions:<strong><em>HelloKafkaTopic1</em></strong>.</p>
<p>Then we create a group of 3 consumers on their own thread to consume the message from the <strong><em>HelloKafkaTopic1</em></strong> topic.</p>
<h4 id="验证-Run-the-example"><a href="#验证-Run-the-example" class="headerlink" title="验证 Run the example"></a>验证 Run the example</h4><p>The output on my eclipse is as below: <!--使用100条message验证，使用3条信息很难出现效果--></p>
<blockquote>
<p><em>Produces 3 messages</em><br><em>Sent:Message 0, Partition: 2, Offset: 21</em><br><em>Sent:Message 3, Partition: 2, Offset: 22</em><br><em>Sent:Message 1, Partition: 1, Offset: 24</em><br><em>Sent:Message 4, Partition: 1, Offset: 25</em><br><em>Sent:Message 2, Partition: 0, Offset: 21</em><br><em>Receive message: Message 2, Partition: 0, Offset: 21, by ThreadID: 13</em><br><em>Receive message: Message 1, Partition: 1, Offset: 24, by ThreadID: 14</em><br><em>Receive message: Message 4, Partition: 1, Offset: 25, by ThreadID: 14</em><br><em>Receive message: Message 0, Partition: 2, Offset: 21, by ThreadID: 15</em><br><em>Receive message: Message 3, Partition: 2, Offset: 22, by ThreadID: 15</em></p>
</blockquote>
<p>Note that the <strong><em>HelloKafkaTopci1</em></strong> has 3 partitions. Kafka producer client assigned the Message 0,3 to the partition #2, the Messages 1,4 to the partition #1 and the Message 2 to the partition 0.</p>
<p>The consumer group which includes 3 consumers with their own threads with ThreadID(s): 13, 14, 15. All the messages of the partition #0 were consumed by the consumer thread: #13. The messages of partition #1 were consumed by the consumer thread #1. And messages of partition #2 were consumed by the consumer thread #15.</p>
<p>Note that you may get the different partition numbers and ThreadIDs. However, in this case, each partition will be handled by each consumer thread.</p>
<h3 id="Model-2-Single-consumer-multiple-worker-processing-threads-1"><a href="#Model-2-Single-consumer-multiple-worker-processing-threads-1" class="headerlink" title="Model #2: Single consumer, multiple worker processing threads"></a>Model #2: Single consumer, multiple worker processing threads</h3><h4 id="Class-Diagram-1"><a href="#Class-Diagram-1" class="headerlink" title="Class Diagram"></a>Class Diagram</h4><p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/single.jpg" alt=" Single consumer, multiple worker processing threads - Class Diagram"></p>
<p>Single consumer, multiple worker processing threads – Class Diagram</p>
<p>The source code for this part includes 4 classes too:</p>
<p><strong>NotificationProducerThread.java</strong> is a producer thread, produces message to the Kafka brokers.</p>
<p><strong>NotificationConsumer.java</strong> is a consumer which has a pool of background threads, receives message from the topic and dispatch to the the pool.</p>
<p><strong>ConsumerThreadHandler.java</strong> is a kind of worker thread which handle business processing for the message which is dispatched from the NotificationConsumer.</p>
<p><strong>SingleConsumerMain</strong>.java. includes the <strong>main</strong> method, run the program to produce and consume messages.</p>
<h4 id="NotificationProducerThread-java-1"><a href="#NotificationProducerThread-java-1" class="headerlink" title="NotificationProducerThread.java"></a><strong>NotificationProducerThread.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.singleconsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.Callback;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.RecordMetadata;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationProducerThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaProducer&lt;String, String&gt; producer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationProducerThread</span><span class="params">(String brokers, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createProducerConfig(brokers);</span><br><span class="line">    <span class="keyword">this</span>.producer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createProducerConfig</span><span class="params">(String brokers)</span> </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">    props.put(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;all&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;retries&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    props.put(<span class="string">&quot;batch.size&quot;</span>, <span class="number">16384</span>);</span><br><span class="line">    props.put(<span class="string">&quot;linger.ms&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    props.put(<span class="string">&quot;buffer.memory&quot;</span>, <span class="number">33554432</span>);</span><br><span class="line">    props.put(<span class="string">&quot;key.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;value.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Produces 5 messages&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">      String msg = <span class="string">&quot;Message &quot;</span> + i;</span><br><span class="line">      producer.send(<span class="keyword">new</span> ProducerRecord&lt;String, String&gt;(topic, msg), <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(RecordMetadata metadata, Exception e)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">          System.out.println(<span class="string">&quot;Sent:&quot;</span> + msg + <span class="string">&quot;, Offset: &quot;</span> + metadata.offset());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// closes producer</span></span><br><span class="line">    producer.close();</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ConsumerThreadHandler-java"><a href="#ConsumerThreadHandler-java" class="headerlink" title="ConsumerThreadHandler.java"></a>ConsumerThreadHandler.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerThreadHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> ConsumerRecord consumerRecord;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ConsumerThreadHandler</span><span class="params">(ConsumerRecord consumerRecord)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.consumerRecord = consumerRecord;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Process: &quot;</span> + consumerRecord.value() + <span class="string">&quot;, Offset: &quot;</span> + consumerRecord.offset()</span><br><span class="line">        + <span class="string">&quot;, By ThreadID: &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This thread processes the message dispatched from the consumer <!--就是消息的处理逻辑，与消息的接受逻辑解耦合了-->. In this example, it simply print out the messages, offsets on the topic and the current ThreadID.</p>
<h4 id="NotificationConsumer-java"><a href="#NotificationConsumer-java" class="headerlink" title="NotificationConsumer.java"></a>NotificationConsumer.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationConsumer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaConsumer&lt;String, String&gt; consumer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line">  <span class="comment">// Threadpool of consumers</span></span><br><span class="line">  <span class="keyword">private</span> ExecutorService executor;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationConsumer</span><span class="params">(String brokers, String groupId, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createConsumerConfig(brokers, groupId);</span><br><span class="line">    <span class="keyword">this</span>.consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">    <span class="keyword">this</span>.consumer.subscribe(Arrays.asList(<span class="keyword">this</span>.topic));</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Creates a &#123;<span class="doctag">@link</span> ThreadPoolExecutor&#125; with a given number of threads to consume the messages</span></span><br><span class="line"><span class="comment">   * from the broker.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> numberOfThreads The number of threads will be used to consume the message</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">int</span> numberOfThreads)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Initialize a ThreadPool with size = 5 and use the BlockingQueue with size =1000 to</span></span><br><span class="line">    <span class="comment">// hold submitted tasks.</span></span><br><span class="line">    executor = <span class="keyword">new</span> ThreadPoolExecutor(numberOfThreads, numberOfThreads, <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">        <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">1000</span>), <span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      ConsumerRecords&lt;String, String&gt; records = consumer.poll(<span class="number">100</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">final</span> ConsumerRecord record : records) &#123;</span><br><span class="line">        executor.submit(<span class="keyword">new</span> ConsumerThreadHandler(record));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createConsumerConfig</span><span class="params">(String brokers, String groupId)</span> </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">    props.put(<span class="string">&quot;group.id&quot;</span>, groupId);</span><br><span class="line">    props.put(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;auto.commit.interval.ms&quot;</span>, <span class="string">&quot;1000&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;session.timeout.ms&quot;</span>, <span class="string">&quot;30000&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (consumer != <span class="keyword">null</span>) &#123;</span><br><span class="line">      consumer.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (executor != <span class="keyword">null</span>) &#123;</span><br><span class="line">      executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!executor.awaitTermination(<span class="number">5000</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        System.out</span><br><span class="line">            .println(<span class="string">&quot;Timed out waiting for consumer threads to shut down, exiting uncleanly&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Interrupted during shutdown, exiting uncleanly&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This class contains a threadpool of ConsumerThreadHandler thread. It receives the message from the topic and dispatch the processing handler for the pool.</p>
<h4 id="SingleConsumerMain-java"><a href="#SingleConsumerMain-java" class="headerlink" title="SingleConsumerMain.java"></a>SingleConsumerMain.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.singleconsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleConsumerMain</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    String brokers = <span class="string">&quot;localhost:9092&quot;</span>;</span><br><span class="line">    String groupId = <span class="string">&quot;group01&quot;</span>;</span><br><span class="line">    String topic = <span class="string">&quot;HelloKafkaTopic&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> numberOfThread = <span class="number">3</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (args != <span class="keyword">null</span> &amp;&amp; args.length &gt; <span class="number">4</span>) &#123;</span><br><span class="line">      brokers = args[<span class="number">0</span>];</span><br><span class="line">      groupId = args[<span class="number">1</span>];</span><br><span class="line">      topic = args[<span class="number">2</span>];</span><br><span class="line">      numberOfThread = Integer.parseInt(args[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Start Notification Producer Thread</span></span><br><span class="line">    NotificationProducerThread producerThread = <span class="keyword">new</span> NotificationProducerThread(brokers, topic);</span><br><span class="line">    Thread t1 = <span class="keyword">new</span> Thread(producerThread);</span><br><span class="line">    t1.start();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Start group of Notification Consumer Thread</span></span><br><span class="line">    NotificationConsumer consumers = <span class="keyword">new</span> NotificationConsumer(brokers, groupId, topic);</span><br><span class="line"> </span><br><span class="line">    consumers.execute(numberOfThread);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">100000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    consumers.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The entry point, contains the main method to run the example. It create a <strong><em>NotificationProducerThread</em></strong> thread which produces 5 messages to the topic: <strong><em>HelloKafkaTopic</em></strong>. Then, it creates a <strong><em>NotificationConsumer</em></strong> object which will receive the message from the above topic and dispatch to the pool of 3 <em>ConsumerThreadHandler</em> thread for processing.</p>
<h4 id="验证-Run-the-example-1"><a href="#验证-Run-the-example-1" class="headerlink" title="验证 Run the example."></a>验证 Run the example.</h4><p>The output on my eclipse is as below: <!--建议数据一定要大，比如100 message--></p>
<blockquote>
<p><em>Produces 5 messages</em><br><em>Sent:Message 0, Offset: 2602</em><br><em>Sent:Message 1, Offset: 2603</em><br><em>Process: Message 0, Offset: 2602, By ThreadID: 13</em><br><em>Process: Message 1, Offset: 2603, By ThreadID: 14</em><br><em>Sent:Message 2, Offset: 2604</em><br><em>Process: Message 2, Offset: 2604, By ThreadID: 15</em><br><em>Sent:Message 3, Offset: 2605</em><br><em>Process: Message 3, Offset: 2605, By ThreadID: 13</em><br><em>Sent:Message 4, Offset: 2606</em><br><em>Process: Message 4, Offset: 2606, By ThreadID: 14</em></p>
</blockquote>
<p>The producer produces 5 messages with offsets from 2602 ~ 2606. Those messages were processed a pool of threads with Ids: 13, 14, 15.</p>
<p>Note that you may get the different Offsets, ThreadID(s).</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>We have taken a look at how to create multi-threaded Apache Kafka consumer with 2 possible models. They have their own pros and cons and depend on the specific circumstance we will decide which one is suitable. Maybe, <a href="">there are some cases which the model #2 is suitable.</a> In this case, each partition of a topic will be handled by each consumer thread. However, if the number messages for this partition is too much and the consumer fall far behind, we may need to combine both the model #1 and model #2.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/15/Christ/%E4%B8%BB%E6%97%A5%E8%AE%B2%E9%81%93/2021-03-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/15/Christ/%E4%B8%BB%E6%97%A5%E8%AE%B2%E9%81%93/2021-03-15/" class="post-title-link" itemprop="url">2021-03-15主日讲道</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-15 13:54:56" itemprop="dateCreated datePublished" datetime="2021-03-15T13:54:56+08:00">2021-03-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-03-14 11:31:35" itemprop="dateModified" datetime="2021-03-14T11:31:35+08:00">2021-03-14</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>《同一脚踪拓展神国之五 充满圣灵》</p>
<p>于宏洁牧师</p>
<ul>
<li>我们所做的任何事，不管是服侍还是日常生活，都是神带领的“副产品”</li>
<li>扩展神国，不是仅仅去海外做宣教士，而是属灵的、神旨意的成全</li>
<li>我们不依靠圣灵，也能服侍，所以我们要提醒自己，我们要努力在圣灵中服侍<ul>
<li>比如，冬虫夏草和毛毛虫在外表一样，但是功效根本不一样</li>
<li>所有的敬拜都是对神的爱的“副产品”，神的爱才是真正的产品；即使没有效果，也是有灵里的改变</li>
</ul>
</li>
</ul>
<p>对圣灵不追求的原因：</p>
<ul>
<li>那不是我的，所以我不在乎；但是那是神真的给我<ul>
<li>基督徒是最富有的乞丐；神把天上的福气都给了我们</li>
</ul>
</li>
<li>苦吃少了</li>
</ul>
<p>基督教的核心：神的内住，生命在圣灵里面的，与神的连接</p>
<p>“圣灵充满“</p>
<ul>
<li>目的：为耶稣做见证，不是满足人<ul>
<li>后现代主义非常注重自我，有些jh强调发现自我恩赐，很讨人的喜欢</li>
<li>不是我，乃是基督。查看、体会这两种的不同。</li>
<li>耶稣基督从不呼召粉丝，他只呼召门徒。</li>
<li>基督永远是我们的中心</li>
</ul>
</li>
<li>为了：就必使我们得能力</li>
<li>如何得到：侍奉神，必然得到能力。这是主的应许。</li>
<li>什么是圣灵充满？耶稣借着圣灵内住在我们心中<ul>
<li>圣灵内住是个事实；但是每个人经历的深度和广度都不同。</li>
</ul>
</li>
</ul>
<p>“圣灵充满“这句话有3个要点：</p>
<ul>
<li>命令式：我们必须这么做。比如“我们必须重生，否则不能进入神的国“</li>
<li>现在式：</li>
<li>被动式：被圣灵充满。人自己没办法办到，如果有人教你说方言、预言、看异象，不要做，因为这些全都是圣灵的工作。</li>
</ul>
<p>我们如何面对“圣灵充满”</p>
<ul>
<li><p>一定要有</p>
<ul>
<li>就像雅格求神的使者，求神赐予</li>
</ul>
</li>
<li><p>一定要常常有</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/15/Christ/%E4%B8%BB%E6%97%A5%E8%AE%B2%E9%81%93/2021-03-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/15/Christ/%E4%B8%BB%E6%97%A5%E8%AE%B2%E9%81%93/2021-03-22/" class="post-title-link" itemprop="url">2021-03-22主日讲道</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-15 13:54:56" itemprop="dateCreated datePublished" datetime="2021-03-15T13:54:56+08:00">2021-03-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-03-28 10:27:10" itemprop="dateModified" datetime="2021-03-28T10:27:10+08:00">2021-03-28</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>《》马太7：7-12</p>
<p>唐崇荣牧师</p>
<ul>
<li><p>上半部分是人的祈祷</p>
<ul>
<li>人的祷告非常狭窄，不要自以为学会祷告了；</li>
<li>人的祷告常常有错误的观念，因为只看见自己的狭窄需要，而看不到永恒神</li>
<li>上帝早知道我们狭窄的需要了，所以神早早地降下祝福了；但是我们为什么要祈求呢？<ul>
<li>好像我们是主动的，神是被动的；我们主动祈求，神被动赐予；这是完全错误的</li>
<li>以弗所书：随己意行的主</li>
</ul>
</li>
</ul>
</li>
<li><p>下半部分是神的心意</p>
</li>
<li><p>这段经文也是很少表明”上帝垂听人的祷告”的经文</p>
</li>
</ul>
<p>既然上帝是完全主动的，并且早早地赐给我们需要的，那么我们为什么还要祈求呢？</p>
<ul>
<li>我们敬拜是靠着圣灵到耶稣面前，我们祈求的原则是靠着圣灵到耶稣面前</li>
<li>到底是谁祈求呢？”你们”是指神的儿女；</li>
<li>没有人行善的，没有人寻求上帝，所以上帝在地上找不到一个寻求他的人。貌似虔诚的人，是自我满足的、自我满意的</li>
<li>一方面神要我们寻求他，一方面神说没有人寻求他；是矛盾的吗？<ul>
<li>如果是抵挡上帝的人，用自己短小的远见，比如共产主义，是认为矛盾的</li>
<li>只有寻求圣经中启示的智慧，才能明白这句话；只有看到真道、厌恶假道的基督徒，才能明白；就是前面说的“你们”：天父的儿女，蒙拣选的族类</li>
<li>外邦人的祈求，不是寻求神的，神不蒙垂听的，除非他们祈求神的赦免；</li>
</ul>
</li>
<li><font color="red">圣徒是照着神的心意、应许祈求, 圣徒的祷告一定是神已经显明和预备的；神很喜欢圣徒与他甜蜜的交通，圣徒承认他的丰盛；</font></li>
</ul>
<p>主告诫我们祷告不要像外邦人，主用主祷文告诫我们该如何祷告</p>
<ul>
<li>巴里人”祷告”，用石头、刀刺自己，非常”虔诚”</li>
<li></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fei Qi</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
