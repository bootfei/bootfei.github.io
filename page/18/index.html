<!DOCTYPE html>
<html lang="en,cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta name="description" content="learn more, forget more; practice more, get more.">
<meta property="og:type" content="website">
<meta property="og:title" content="BootFei&#39;s Blog">
<meta property="og:url" content="http://example.com/page/18/index.html">
<meta property="og:site_name" content="BootFei&#39;s Blog">
<meta property="og:description" content="learn more, forget more; practice more, get more.">
<meta property="og:locale">
<meta property="article:author" content="Fei Qi">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/18/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en,cn'
  };
</script>

  <title>BootFei's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">BootFei's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">敬畏耶和华是智慧的开端，认识至圣者就是聪明</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Fei Qi</p>
  <div class="site-description" itemprop="description">learn more, forget more; practice more, get more.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">305</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/16/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/springboot/springboot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B-1.2.6-%20afterRefresh(context)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/16/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/springboot/springboot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B-1.2.6-%20afterRefresh(context)/" class="post-title-link" itemprop="url">springboot启动流程-01-启动流程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-16 09:30:13" itemprop="dateCreated datePublished" datetime="2021-04-16T09:30:13+08:00">2021-04-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-11-22 13:41:11" itemprop="dateModified" datetime="2021-11-22T13:41:11+08:00">2021-11-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id=""><a href="#" class="headerlink" title=""></a></h5><h5 id="Spring-Context后置处理"><a href="#Spring-Context后置处理" class="headerlink" title="Spring Context后置处理"></a>Spring Context后置处理</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterRefresh</span><span class="params">(ConfigurableApplicationContext context,</span></span></span><br><span class="line"><span class="function"><span class="params">            ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">    callRunners(context, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callRunners</span><span class="params">(ApplicationContext context, ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">    List&lt;Object&gt; runners = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">    runners.addAll(context.getBeansOfType(ApplicationRunner.class).values());</span><br><span class="line">    runners.addAll(context.getBeansOfType(CommandLineRunner.class).values());</span><br><span class="line">    AnnotationAwareOrderComparator.sort(runners);</span><br><span class="line">    <span class="keyword">for</span> (Object runner : <span class="keyword">new</span> LinkedHashSet&lt;Object&gt;(runners)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (runner <span class="keyword">instanceof</span> ApplicationRunner) &#123;</span><br><span class="line">            callRunner((ApplicationRunner) runner, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (runner <span class="keyword">instanceof</span> CommandLineRunner) &#123;</span><br><span class="line">            callRunner((CommandLineRunner) runner, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callRunner</span><span class="params">(ApplicationRunner runner, ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        (runner).run(args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Failed to execute ApplicationRunner&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callRunner</span><span class="params">(CommandLineRunner runner, ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        (runner).run(args.getSourceArgs());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Failed to execute CommandLineRunner&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所谓的后置操作，就是在容器完成刷新后，依次调用注册的Runners</p>
<ul>
<li>org.springframework.boot.ApplicationRunner</li>
<li>org.springframework.boot.CommandLineRunner</li>
</ul>
<p><strong>CommandLineRunner、ApplicationRunner 接口是在容器启动成功后的最后一步回调（类似开机自启动）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/15/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/jdk/JDK-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/15/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/jdk/JDK-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="post-title-link" itemprop="url">JDK-正则表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-15 13:30:09" itemprop="dateCreated datePublished" datetime="2021-04-15T13:30:09+08:00">2021-04-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-04-27 17:16:11" itemprop="dateModified" datetime="2021-04-27T17:16:11+08:00">2021-04-27</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="校验数字的表达式"><a href="#校验数字的表达式" class="headerlink" title="校验数字的表达式"></a>校验数字的表达式</h2><ol>
<li>数字：<code>^[0-9]*$</code></li>
<li>n位的数字：<code>^\d&#123;n&#125;$</code></li>
<li>至少n位的数字：<code>^\d&#123;n,&#125;$</code></li>
<li>m-n位的数字：<code>^\d&#123;m,n&#125;$</code></li>
<li>零和非零开头的数字：<code>^(0|[1-9][0-9]*)$</code></li>
<li>非零开头的最多带两位小数的数字：<code>^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$</code></li>
<li>带1-2位小数的正数或负数：<code>^(\-)?\d+(\.\d&#123;1,2&#125;)?$</code></li>
<li>正数、负数、和小数：<code>^(\-|\+)?\d+(\.\d+)?$</code></li>
<li>有两位小数的正实数：<code>^[0-9]+(.[0-9]&#123;2&#125;)?$</code></li>
<li>有1~3位小数的正实数：<code>^[0-9]+(.[0-9]&#123;1,3&#125;)?$</code></li>
<li>非零的正整数：<code>^[1-9]\d*$ 或 ^([1-9][0-9]*)&#123;1,3&#125;$ 或 ^\+?[1-9][0-9]*$</code></li>
<li>非零的负整数：<code>^\-[1-9][]0-9&quot;*$ 或 ^-[1-9]\d*$</code></li>
<li>非负整数：<code>^\d+$ 或 ^[1-9]\d*|0$</code></li>
<li>非正整数：<code>^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$</code></li>
<li>非负浮点数：<code>^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$</code></li>
<li>非正浮点数：<code>^((-\d+(\.\d+)?)|(0+(\.0+)?))$ 或 ^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$</code></li>
<li>正浮点数：<code>^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$ 或 ^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</code></li>
<li>负浮点数：<code>^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ 或 ^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$</code></li>
<li>浮点数：<code>^(-?\d+)(\.\d+)?$ 或 ^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$</code></li>
</ol>
<h2 id="校验字符的表达式"><a href="#校验字符的表达式" class="headerlink" title="校验字符的表达式"></a>校验字符的表达式</h2><ol>
<li>汉字：<code>^[\u4e00-\u9fa5]&#123;0,&#125;$</code></li>
<li>英文和数字：<code>^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]&#123;4,40&#125;$</code></li>
<li>长度为3-20的所有字符：<code>^.&#123;3,20&#125;$</code></li>
<li>由26个英文字母组成的字符串：<code>^[A-Za-z]+$</code></li>
<li>由26个大写英文字母组成的字符串：<code>^[A-Z]+$</code></li>
<li>由26个小写英文字母组成的字符串：<code>^[a-z]+$</code></li>
<li>由数字和26个英文字母组成的字符串：<code>^[A-Za-z0-9]+$</code></li>
<li>由数字、26个英文字母或者下划线组成的字符串：<code>^\w+$ 或 ^\w&#123;3,20&#125;</code></li>
<li>中文、英文、数字包括下划线：<code>^[\u4E00-\u9FA5A-Za-z0-9_]+$</code></li>
<li>中文、英文、数字但不包括下划线等符号：<code>^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]&#123;2,20&#125;$</code></li>
<li>可以输入含有<code>^%&amp;&#39;,;=?$\&quot;</code>等字符：<code>[^%&amp;&#39;,;=?$\x22]+</code></li>
<li>禁止输入含有<del>的字符`[^</del>\x22]+`</li>
</ol>
<p>其它：</p>
<p><code>.*</code>匹配除 <code>\n</code> 以外的任何字符。</p>
<p><code>/[\u4E00-\u9FA5]/</code> 汉字</p>
<p><code>/[\uFF00-\uFFFF]/</code> 全角符号</p>
<p><code>/[\u0000-\u00FF]/</code> 半角符号</p>
<h2 id="特殊需求表达式"><a href="#特殊需求表达式" class="headerlink" title="特殊需求表达式"></a>特殊需求表达式</h2><ol>
<li>Email地址：<code>^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</code></li>
<li>域名：<code>[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/.?</code></li>
<li>InternetURL：<code>[a-zA-z]+://[^\s]* 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$</code></li>
<li>手机号码：<code>^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d&#123;8&#125;$</code></li>
<li>电话号码(“XXX-XXXXXXX”、”XXXX-XXXXXXXX”、”XXX-XXXXXXX”、”XXX-XXXXXXXX”、”XXXXXXX”和”XXXXXXXX)：<code>^(\(\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$</code></li>
<li>国内电话号码(0511-4405222、021-87888822)：<code>\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;</code></li>
<li>身份证号(15位、18位数字)：<code>^\d&#123;15&#125;|\d&#123;18&#125;$</code></li>
<li>短身份证号码(数字、字母x结尾)：<code>^([0-9])&#123;7,18&#125;(x|X)?$ 或 ^\d&#123;8,18&#125;|[0-9x]&#123;8,18&#125;|[0-9X]&#123;8,18&#125;?$</code></li>
<li>帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：<code>^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$</code></li>
<li>密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：<code>^[a-zA-Z]\w&#123;5,17&#125;$</code></li>
<li>强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)：<code>^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).&#123;8,10&#125;$</code></li>
<li>日期格式：<code>^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;</code></li>
<li>一年的12个月(01～09和1～12)：<code>^(0?[1-9]|1[0-2])$</code></li>
<li>一个月的31天(01～09和1～31)：<code>^((0?[1-9])|((1|2)[0-9])|30|31)$</code></li>
</ol>
<h3 id="钱的输入格式："><a href="#钱的输入格式：" class="headerlink" title="钱的输入格式："></a>钱的输入格式：</h3><p>1.有四种钱的表示形式我们可以接受:”10000.00” 和 “10,000.00”, 和没有 “分” 的 “10000” 和 “10,000”：<code>^[1-9][0-9]*$</code></p>
<p>2.这表示任意一个不以0开头的数字,但是,这也意味着一个字符”0”不通过,所以我们采用下面的形式：<code>^(0|[1-9][0-9]*)$</code></p>
<p>3.一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号：<code>^(0|-?[1-9][0-9]*)$</code></p>
<p>4.这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉,因为钱总不能是负的吧.下面我们要加的是说明可能的小数部分：<code>^[0-9]+(.[0-9]+)?$</code></p>
<p>5.必须说明的是,小数点后面至少应该有1位数,所以”10.”是不通过的,但是 “10” 和 “10.2” 是通过的：<code>^[0-9]+(.[0-9]&#123;2&#125;)?$</code></p>
<p>6.这样我们规定小数点后面必须有两位,如果你认为太苛刻了,可以这样：<code>^[0-9]+(.[0-9]&#123;1,2&#125;)?$</code></p>
<p>7.这样就允许用户只写一位小数.下面我们该考虑数字中的逗号了,我们可以这样：<code>^[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*(.[0-9]&#123;1,2&#125;)?$</code></p>
<p>8.1到3个数字,后面跟着任意个 逗号+3个数字,逗号成为可选,而不是必须：<code>^([0-9]+|[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*)(.[0-9]&#123;1,2&#125;)?$</code></p>
<blockquote>
<p>备注：这就是最终结果了,别忘了<code>+</code>可以用<code>*</code>替代如果你觉得空字符串也可以接受的话(奇怪,为什么?)最后,别忘了在用函数时去掉去掉那个反斜杠,一般的错误都在这里</p>
</blockquote>
<ol>
<li>xml文件：<code>^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\.[x|X][m|M][l|L]$</code></li>
<li>中文字符的正则表达式：<code>[\u4e00-\u9fa5]</code></li>
<li>双字节字符：<code>[^\x00-\xff]</code> (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))</li>
<li>空白行的正则表达式：<code>\n\s*\r</code> (可以用来删除空白行)</li>
<li>HTML标记的正则表达式：<code>&lt;(\S*?)[^&gt;]*&gt;.*?&lt;/\1&gt;|&lt;.*? /&gt;</code> (网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力)</li>
<li>首尾空白字符的正则表达式：<code>^\s*|\s*$或(^\s*)|(\s*$)</code> (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</li>
<li>腾讯QQ号：<code>[1-9][0-9]&#123;4,&#125;</code> (腾讯QQ号从10000开始)</li>
<li>中国邮政编码：<code>[1-9]\d&#123;5&#125;(?!\d)</code> (中国邮政编码为6位数字)</li>
<li>IP地址：<code>\d+\.\d+\.\d+\.\d+</code> (提取IP地址时有用)</li>
<li>IP地址：<code>((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</code></li>
<li>IP-v4地址：<code>\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b</code> (提取IP地址时有用)</li>
<li>校验IP-v6地址:<code>(([0-9a-fA-F]&#123;1,4&#125;:)&#123;7,7&#125;[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,7&#125;:|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,6&#125;:[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,5&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,2&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,3&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,3&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,2&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,5&#125;|[0-9a-fA-F]&#123;1,4&#125;:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,6&#125;)|:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,7&#125;|:)|fe80:(:[0-9a-fA-F]&#123;0,4&#125;)&#123;0,4&#125;%[0-9a-zA-Z]&#123;1,&#125;|::(ffff(:0&#123;1,4&#125;)&#123;0,1&#125;:)&#123;0,1&#125;((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;:((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9]))</code></li>
<li>子网掩码：<code>((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</code></li>
<li>校验日期:<code>^(?:(?!0000)[0-9]&#123;4&#125;-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]&#123;2&#125;(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$</code>(“yyyy-mm-dd“ 格式的日期校验，已考虑平闰年。)</li>
<li>抽取注释：<code>&lt;!--(.*?)--&gt;</code></li>
<li>查找CSS属性:<code>^\\s*[a-zA-Z\\-]+\\s*[:]&#123;1&#125;\\s[a-zA-Z0-9\\s.#]+[;]&#123;1&#125;</code></li>
<li>提取页面超链接:<code>(&lt;a\\s*(?!.*\\brel=)[^&gt;]*)(href=&quot;https?:\\/\\/)((?!(?:(?:www\\.)?&#39;.implode(&#39;|(?:www\\.)?&#39;, $follow_list).&#39;))[^&quot; rel=&quot;external nofollow&quot; ]+)&quot;((?!.*\\brel=)[^&gt;]*)(?:[^&gt;]*)&gt;</code></li>
<li>提取网页图片:<code>\\&lt; *[img][^\\\\&gt;]*[src] *= *[\\&quot;\\&#39;]&#123;0,1&#125;([^\\&quot;\\&#39;\\ &gt;]*)</code></li>
<li>提取网页颜色代码:<code>^#([A-Fa-f0-9]&#123;6&#125;|[A-Fa-f0-9]&#123;3&#125;)$</code></li>
<li>文件扩展名效验:<code>^([a-zA-Z]\\:|\\\\)\\\\([^\\\\]+\\\\)*[^\\/:*?&quot;&lt;&gt;|]+\\.txt(l)?$</code></li>
<li>判断IE版本：<code>^.*MSIE [5-8](?:\\.[0-9]+)?(?!.*Trident\\/[5-9]\\.0).*$</code></li>
</ol>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="附表"><a href="#附表" class="headerlink" title="附表:"></a>附表:</h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PC67neGZ425peCPYXC9OKrLr9kRBdCjLbElZbQNtOibye9qsP08tvBR9A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PC10t4Hujwia7AIiage1jJ4icDXbg07wSibAJgvqs00sg1yQocFpVX3t667A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PC49ulu1a6RmqgKRcLRpEtrpeTBllJvt4Pd0icP2njxxUSEicreY125KGQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PCyjQhlcsO3SVOmBmxNN7lIfNfnHys7hxlicedf8aLAOUBlfcSGP3uibiaA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PC7KFmevIEwPz25nvlptWCqWmjdnsDQTMGVc6VIib3A3icw9kN5BSupmOQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PC2sx0J0UZEfrAk7bA6mOFIDViaddEffopAuw6sXXvbqnHYibkbBdf8ic4w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PCURqGIY61icvGlhmib8dvG3gwT7Rdiay5VIf6mRICQFfGpff0ia4DILJWMg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PCPicytQUVee0j8NS6eYWJicaT8bzAAAKPNfRHhRDArlDaEumOqeX6vnEA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PCYJf59Yic4ACLXgGnWLeg5BP46AjaRiat9ZQHabaXovdMrsVAEv87Y3Sg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufndG3m3Odth7t4Uku459PCaIVfq9ntr8kxNRxVh9Orv5mSHBK5BlbiaGKjZqtNkicQrRXiclPENlvEw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenMatchesTenDigitsNumberWhitespacesDotHyphen_thenCorrect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Pattern pattern = Pattern.compile(<span class="string">&quot;^(\\d&#123;3&#125;[- .]?)&#123;2&#125;\\d&#123;4&#125;$&quot;</span>);</span><br><span class="line">    Matcher matcher = pattern.matcher(<span class="string">&quot;202 555 0125&quot;</span>);</span><br><span class="line">    assertTrue(matcher.matches());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-01-LRU%E5%AE%9E%E7%8E%B0%20(copy)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-01-LRU%E5%AE%9E%E7%8E%B0%20(copy)/" class="post-title-link" itemprop="url">redis源码-LRU实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-15 13:24:31" itemprop="dateCreated datePublished" datetime="2021-04-15T13:24:31+08:00">2021-04-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-03-15 11:22:59" itemprop="dateModified" datetime="2023-03-15T11:22:59+08:00">2023-03-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98/09%20%20Redis%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8select%E3%80%81poll%E3%80%81epoll%EF%BC%9F.md">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98/09%20%20Redis%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8select%E3%80%81poll%E3%80%81epoll%EF%BC%9F.md</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-09-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-09-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%20/" class="post-title-link" itemprop="url">redis源码-LRU实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-15 13:24:31" itemprop="dateCreated datePublished" datetime="2021-04-15T13:24:31+08:00">2021-04-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-03-16 15:45:02" itemprop="dateModified" datetime="2023-03-16T15:45:02+08:00">2023-03-16</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98/09%20%20Redis%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8select%E3%80%81poll%E3%80%81epoll%EF%BC%9F.md">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98/09%20%20Redis%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8select%E3%80%81poll%E3%80%81epoll%EF%BC%9F.md</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server = <span class="keyword">new</span> Socker();</span><br><span class="line"></span><br><span class="line">server.bind(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">Server.listen();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">	connSocket = server.accept(); <span class="comment">//accept 函数只能在一个监听套接字上监听客户端的连接，</span></span><br><span class="line">  connSocket.receive(); <span class="comment">//recv 函数也只能在一个已连接套接字上，等待客户端发送的请求。</span></span><br><span class="line">  connSocket.send(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server = <span class="keyword">new</span> Socker();</span><br><span class="line"></span><br><span class="line">server.bind(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">Server.listen();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">	conn = server.accept();</span><br><span class="line">  pthread_create(conn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pthread_create(conn)&#123;</span><br><span class="line">  conn.receive();</span><br><span class="line">  conn.send(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-LRU%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-LRU%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">redis源码-LRU实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-04-15 13:24:31 / Modified: 13:26:18" itemprop="dateCreated datePublished" datetime="2021-04-15T13:24:31+08:00">2021-04-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="LRU是什么"><a href="#LRU是什么" class="headerlink" title="LRU是什么"></a>LRU是什么</h1><p>LRU(least recently used)是一种缓存置换算法。即在缓存有限的情况下，如果有新的数据需要加载进缓存，则需要将最不可能被继续访问的缓存剔除掉。因为缓存是否可能被访问到没法做预测，所以基于如下假设实现该算法:</p>
<p><strong>如果一个key经常被访问，那么该key的idle time应该是最小的。</strong></p>
<p>(但这个假设也是基于概率，并不是充要条件,很明显,idle time最小的,甚至都不一定会被再次访问到)</p>
<p>这也就是LRU的实现思路。首先实现一个双向链表,每次有一个key被访问之后，就把被访问的key放到链表的头部。当缓存不够时,直接从尾部逐个摘除。</p>
<p>在这种假设下的实现方法很明显会有一个问题，例如mysql中执行如下一条语句:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from table_a;</span><br></pre></td></tr></table></figure>

<p>如果table_a中有大量数据并且读取之后不会继续使用,则LRU头部会被大量的table_a中的数据占据。这样会造成热点数据被逐出缓存从而导致大量的磁盘io</p>
<p>mysql innodb的buffer pool使用了一种改进的LRU算法，大意是将LRU链表分成两部分，一部分为newlist,一部分为oldlist,newlist是头部热点数据，oldlist是非热点数据,oldlist默认占整个list长度的3/8.当初次加载一个page的时候，会首先放入oldlist的头部，再次访问时才会移动到newlist.具体参考如下文章:</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html">https://dev.mysql.com/doc/ref…</a></p>
<p>而Redis整体上是一个大的dict，如果实现一个双向链表需要在每个key上首先增加两个指针，需要16个字节，并且额外需要一个list结构体去存储该双向链表的头尾节点信息。Redis作者认为这样实现不仅内存占用太大，而且可能导致性能降低。他认为既然LRU本来就是基于假设做出的算法，为什么不能模拟实现一个LRU呢。</p>
<h1 id="Redis中的实现"><a href="#Redis中的实现" class="headerlink" title="Redis中的实现"></a><a target="_blank" rel="noopener" href="https://redis.io/topics/lru-cache">Redis中的实现</a></h1><p>首先Redis并没有使用双向链表实现一个LRU算法。具体实现方法接下来逐步介绍</p>
<p>首先看一下robj结构体(Redis整体上是一个大的dict,key是一个string,而value都会保存为一个robj)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef struct redisObject &#123;</span><br><span class="line">    ...</span><br><span class="line">    unsigned lru:LRU_BITS; &#x2F;&#x2F;LRU_BITS为24bit</span><br><span class="line">    ...</span><br><span class="line">&#125; robj;</span><br></pre></td></tr></table></figure>

<p>我们看到每个robj中都有一个24bit长度的lru字段，lru字段里边保存的是一个时间戳。看下边的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">robj *lookupKey(redisDb *db, robj *key, int flags) &#123;</span><br><span class="line">    ...</span><br><span class="line">            if (server.maxmemory_policy &amp; MAXMEMORY_FLAG_LFU) &#123; &#x2F;&#x2F;如果配置的是lfu方式，则更新lfu</span><br><span class="line">                updateLFU(val);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                val-&gt;lru &#x3D; LRU_CLOCK();&#x2F;&#x2F;否则按lru方式更新</span><br><span class="line">            &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Redis的dict中每次按key获取一个值的时候，都会调用lookupKey函数,如果配置使用了LRU模式,该函数会更新value中的lru字段为当前秒级别的时间戳(lfu方式后文再描述)。</p>
<p>那么，虽然记录了每个value的时间戳，但是淘汰时总不能挨个遍历dict中的所有槽，逐个比较lru大小吧。</p>
<p>Redis初始的实现算法很简单，随机从dict中取出五个key,淘汰一个lru字段值最小的。(随机选取的key是个可配置的参数maxmemory-samples,默认值为5).</p>
<p>在3.0的时候，又改进了一版算法，首先第一次随机选取的key都会放入一个pool中(pool的大小为16),pool中的key是按lru大小顺序排列的。接下来每次随机选取的keylru值必须小于pool中最小的lru才会继续放入，直到将pool放满。放满之后，每次如果有新的key需要放入，需要将pool中lru最大的一个key取出。</p>
<p>淘汰的时候，直接从pool中选取一个lru最小的值然后将其淘汰。</p>
<p>我们知道Redis执行命令时首先会调用processCommand函数，在processCommand中会进行key的淘汰，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int processCommmand()&#123;</span><br><span class="line">    ...</span><br><span class="line">    if (server.maxmemory &amp;&amp; !server.lua_timedout) &#123;</span><br><span class="line">        int out_of_memory &#x3D; freeMemoryIfNeeded() &#x3D;&#x3D; C_ERR;&#x2F;&#x2F;如果开启了maxmemory的限制,则会调用freeMemoryIfNeeded()函数，该函数中进行缓存的淘汰</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，lru本身是基于概率的猜测，这个算法也是基于概率的猜测，也就是作者说的模拟lru.那么效果如何呢？作者做了个实验，如下图所示</p>
<p><img src="https://segmentfault.com/img/bVblPdJ?w=854&h=449" alt="clipboard.png"></p>
<p>首先加入n个key并顺序访问这n个key,之后加入n/2个key（假设redis中只能保存n个key,于是会有n/2个key被逐出）.上图中浅灰色为被逐出的key,淡蓝色是新增加的key,灰色的为最近被访问的key(即不会被lru逐出的key)</p>
<p>左上图为理想中的LRU算法,新增加的key和最近被访问的key都不应该被逐出。</p>
<p>可以看到,Redis2.8当每次随机采样5个key时，新增加的key和最近访问的key都有一定概率被逐出</p>
<p>Redis3.0增加了pool后效果好一些(右下角的图)。当Redis3.0增加了pool并且将采样key增加到10个后，基本等同于理想中的LRU(虽然还是有一点差距)</p>
<p>如果继续增加采样的key或者pool的大小，作者发现很能进一步优化LRU算法,于是作者开始转换思路。</p>
<p>上文介绍了实现LRU的一种思路,<strong>即如果一个key经常被访问，那么该key的idle time应该是最小的。</strong></p>
<p>那么能不能换一种思路呢。<strong>如果能够记录一个key被访问的次数,那么经常被访问的key最有可能再次被访问到。</strong>这也就是lfu(least frequently used),访问次数最少的最应该被逐出。</p>
<p>lfu的代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">void updateLFU(robj *val) &#123;</span><br><span class="line">    unsigned long counter &#x3D; LFUDecrAndReturn(val);&#x2F;&#x2F;首先计算是否需要将counter衰减</span><br><span class="line">    counter &#x3D; LFULogIncr(counter);&#x2F;&#x2F;根据上述返回的counter计算新的counter</span><br><span class="line">    val-&gt;lru &#x3D; (LFUGetTimeInMinutes()&lt;&lt;8) | counter; &#x2F;&#x2F;robj中的lru字段只有24bits,lfu复用该字段。高16位存储一个分钟数级别的时间戳，低8位存储访问计数</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">unsigned long LFUDecrAndReturn(robj *o) &#123;</span><br><span class="line">    unsigned long ldt &#x3D; o-&gt;lru &gt;&gt; 8;&#x2F;&#x2F;原来保存的时间戳</span><br><span class="line">    unsigned long counter &#x3D; o-&gt;lru &amp; 255; &#x2F;&#x2F;原来保存的counter</span><br><span class="line">    unsigned long num_periods &#x3D; server.lfu_decay_time ? LFUTimeElapsed(ldt) &#x2F; server.lfu_decay_time : 0;</span><br><span class="line">    &#x2F;&#x2F;server.lfu_decay_time默认为1,每经过一分钟counter衰减1</span><br><span class="line">    if (num_periods)</span><br><span class="line">        counter &#x3D; (num_periods &gt; counter) ? 0 : counter - num_periods;&#x2F;&#x2F;如果需要衰减,则计算衰减后的值</span><br><span class="line">    return counter;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">uint8_t LFULogIncr(uint8_t counter) &#123;</span><br><span class="line">    if (counter &#x3D;&#x3D; 255) return 255;&#x2F;&#x2F;counter最大只能存储到255,到达后不再增加</span><br><span class="line">    double r &#x3D; (double)rand()&#x2F;RAND_MAX;&#x2F;&#x2F;算一个随机的小数值</span><br><span class="line">    double baseval &#x3D; counter - LFU_INIT_VAL;&#x2F;&#x2F;新加入的key初始counter设置为LFU_INIT_VAL,为5.不设置为0的原因是防止直接被逐出</span><br><span class="line">    if (baseval &lt; 0) baseval &#x3D; 0;</span><br><span class="line">    double p &#x3D; 1.0&#x2F;(baseval*server.lfu_log_factor+1);&#x2F;&#x2F;server.lfu_log_facotr默认为10</span><br><span class="line">    if (r &lt; p) counter++;&#x2F;&#x2F;可以看到,counter越大,则p越小，随机值r小于p的概率就越小。换言之,counter增加起来会越来越缓慢</span><br><span class="line">    return counter;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">unsigned long LFUGetTimeInMinutes(void) &#123;</span><br><span class="line">    return (server.unixtime&#x2F;60) &amp; 65535;&#x2F;&#x2F;获取分钟级别的时间戳</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LRU本质上是一个概率计数器，称为morris counter.随着访问次数的增加,counter的增加会越来越缓慢。如下是访问次数与counter值之间的关系</p>
<p><img src="https://segmentfault.com/img/bVblPdW?w=2538&h=914" alt="clipboard.png"></p>
<p>factor即server.lfu_log_facotr配置值，默认为10.可以看到,一个key访问一千万次以后counter值才会到达255.factor值越小, counter越灵敏</p>
<p>lfu随着分钟数对counter做衰减是基于一个原理:过去被大量访问的key不一定现在仍然会被访问。相当于除了计数，给时间也增加了一定的权重。</p>
<p>淘汰时就很简单了，仍然是一个pool,随机选取10个key,counter最小的被淘汰</p>
<h1 id="算法验证"><a href="#算法验证" class="headerlink" title="算法验证"></a>算法验证</h1><p>redis-cli提供了一个参数,可以验证LRU算法的效率。主要是通过验证hits/miss的比率，来判断淘汰算法是否有效。命中比率高说明确实淘汰了不会被经常访问的key.具体做法如下:</p>
<p>配置redis LRU算法为 allkeys-lru</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test ~&#x2F;redis-5.0.0$.&#x2F;src&#x2F;redis-cli -p 6380</span><br><span class="line">127.0.0.1:6380&gt; config set maxmemory 50m &#x2F;&#x2F;设置redis最大使用50M内存</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; config get  maxmemory-policy</span><br><span class="line">1) &quot;maxmemory-policy&quot;</span><br><span class="line">2) &quot;noeviction&quot;</span><br><span class="line">127.0.0.1:6380&gt; config set maxmemory-policy allkeys-lru&#x2F;&#x2F;设置lru算法为allkeys-lru</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>执行redis-cli –lru-test验证命中率</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;src&#x2F;redis-cli -p 6380 --lru-test 1000000&#x2F;&#x2F;模拟100万个key</span><br></pre></td></tr></table></figure>

<p>通过info查看使用的内存和被逐出的keys</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"># Memory</span><br><span class="line">used_memory:50001216</span><br><span class="line">...</span><br><span class="line">evicted_keys:115092</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>查看lru-test的输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">131250 Gets&#x2F;sec | Hits: 124113 (94.56%) | Misses: 7137 (5.44%)</span><br><span class="line">132250 Gets&#x2F;sec | Hits: 125091 (94.59%) | Misses: 7159 (5.41%)</span><br><span class="line">131250 Gets&#x2F;sec | Hits: 124027 (94.50%) | Misses: 7223 (5.50%)</span><br><span class="line">133000 Gets&#x2F;sec | Hits: 125855 (94.63%) | Misses: 7145 (5.37%)</span><br><span class="line">136250 Gets&#x2F;sec | Hits: 128882 (94.59%) | Misses: 7368 (5.41%)</span><br><span class="line">139750 Gets&#x2F;sec | Hits: 132231 (94.62%) | Misses: 7519 (5.38%)</span><br><span class="line">136000 Gets&#x2F;sec | Hits: 128702 (94.63%) | Misses: 7298 (5.37%)</span><br><span class="line">134500 Gets&#x2F;sec | Hits: 127374 (94.70%) | Misses: 7126 (5.30%)</span><br><span class="line">134750 Gets&#x2F;sec | Hits: 127427 (94.57%) | Misses: 7323 (5.43%)</span><br><span class="line">134250 Gets&#x2F;sec | Hits: 127004 (94.60%) | Misses: 7246 (5.40%)</span><br><span class="line">138500 Gets&#x2F;sec | Hits: 131019 (94.60%) | Misses: 7481 (5.40%)</span><br><span class="line">130000 Gets&#x2F;sec | Hits: 122918 (94.55%) | Misses: 7082 (5.45%)</span><br><span class="line">126500 Gets&#x2F;sec | Hits: 119646 (94.58%) | Misses: 6854 (5.42%)</span><br><span class="line">132750 Gets&#x2F;sec | Hits: 125672 (94.67%) | Misses: 7078 (5.33%)</span><br><span class="line">136000 Gets&#x2F;sec | Hits: 128563 (94.53%) | Misses: 7437 (5.47%)</span><br><span class="line">132500 Gets&#x2F;sec | Hits: 125450 (94.68%) | Misses: 7050 (5.32%)</span><br><span class="line">132250 Gets&#x2F;sec | Hits: 125234 (94.69%) | Misses: 7016 (5.31%)</span><br><span class="line">133000 Gets&#x2F;sec | Hits: 125761 (94.56%) | Misses: 7239 (5.44%)</span><br><span class="line">134750 Gets&#x2F;sec | Hits: 127431 (94.57%) | Misses: 7319 (5.43%)</span><br><span class="line">130750 Gets&#x2F;sec | Hits: 123707 (94.61%) | Misses: 7043 (5.39%)</span><br><span class="line">133500 Gets&#x2F;sec | Hits: 126195 (94.53%) | Misses: 7305 (5.47%)</span><br></pre></td></tr></table></figure>

<p>大概有5%-5.5%之间的miss概率。我们将LRU策略切换为allkeys-lfu，再次实验</p>
<p>结果如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">131250 Gets&#x2F;sec | Hits: 124480 (94.84%) | Misses: 6770 (5.16%)</span><br><span class="line">134750 Gets&#x2F;sec | Hits: 127926 (94.94%) | Misses: 6824 (5.06%)</span><br><span class="line">130000 Gets&#x2F;sec | Hits: 123458 (94.97%) | Misses: 6542 (5.03%)</span><br><span class="line">127750 Gets&#x2F;sec | Hits: 121231 (94.90%) | Misses: 6519 (5.10%)</span><br><span class="line">130500 Gets&#x2F;sec | Hits: 123958 (94.99%) | Misses: 6542 (5.01%)</span><br><span class="line">130500 Gets&#x2F;sec | Hits: 123935 (94.97%) | Misses: 6565 (5.03%)</span><br><span class="line">131250 Gets&#x2F;sec | Hits: 124622 (94.95%) | Misses: 6628 (5.05%)</span><br><span class="line">131250 Gets&#x2F;sec | Hits: 124618 (94.95%) | Misses: 6632 (5.05%)</span><br><span class="line">128000 Gets&#x2F;sec | Hits: 121315 (94.78%) | Misses: 6685 (5.22%)</span><br><span class="line">129000 Gets&#x2F;sec | Hits: 122585 (95.03%) | Misses: 6415 (4.97%)</span><br><span class="line">132000 Gets&#x2F;sec | Hits: 125277 (94.91%) | Misses: 6723 (5.09%)</span><br><span class="line">134000 Gets&#x2F;sec | Hits: 127329 (95.02%) | Misses: 6671 (4.98%)</span><br><span class="line">131750 Gets&#x2F;sec | Hits: 125258 (95.07%) | Misses: 6492 (4.93%)</span><br><span class="line">136000 Gets&#x2F;sec | Hits: 129207 (95.01%) | Misses: 6793 (4.99%)</span><br><span class="line">135500 Gets&#x2F;sec | Hits: 128659 (94.95%) | Misses: 6841 (5.05%)</span><br><span class="line">133750 Gets&#x2F;sec | Hits: 126995 (94.95%) | Misses: 6755 (5.05%)</span><br><span class="line">131250 Gets&#x2F;sec | Hits: 124680 (94.99%) | Misses: 6570 (5.01%)</span><br><span class="line">129750 Gets&#x2F;sec | Hits: 123408 (95.11%) | Misses: 6342 (4.89%)</span><br><span class="line">130500 Gets&#x2F;sec | Hits: 124043 (95.05%) | Misses: 6457 (4.95%)</span><br></pre></td></tr></table></figure>

<p>%5左右的miss率，在这个测试下,LFU比LRU的预测准确率略微高一些。</p>
<p>在实际生产环境中,不同的redis访问模式需要配置不同的LRU策略， 然后可以通过lru test工具验证效果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-10-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%95%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/15/database/redis/redis%E6%BA%90%E7%A0%81-10-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%95%E7%BA%BF%E7%A8%8B/" class="post-title-link" itemprop="url">redis源码-LRU实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-15 13:24:31" itemprop="dateCreated datePublished" datetime="2021-04-15T13:24:31+08:00">2021-04-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-03-15 11:24:37" itemprop="dateModified" datetime="2023-03-15T11:24:37+08:00">2023-03-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98/09%20%20Redis%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8select%E3%80%81poll%E3%80%81epoll%EF%BC%9F.md">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98/09%20%20Redis%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8select%E3%80%81poll%E3%80%81epoll%EF%BC%9F.md</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/14/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/jdk/JDK-lang-Annotation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/14/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/jdk/JDK-lang-Annotation/" class="post-title-link" itemprop="url">JDK-lang-Annotation</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-14 12:50:22" itemprop="dateCreated datePublished" datetime="2021-04-14T12:50:22+08:00">2021-04-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-09-14 18:23:49" itemprop="dateModified" datetime="2021-09-14T18:23:49+08:00">2021-09-14</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Java 注解(Annotation)又称 Java 标注，是 JDK5.0 引入的一种注释机制。</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>编译格式检查</li>
<li>反射中解析</li>
<li>生成帮助文档</li>
<li>跟踪代码依赖</li>
</ul>
<h3 id="内置注解"><a href="#内置注解" class="headerlink" title="内置注解"></a>内置注解</h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufMhhxMFuSA30XB7aViccfX0Z2ngxxej4ImcDQ1VYaMh9ibaEzw6bv3csI5Lo1A7MjBbK6HY9vm3zkw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<blockquote>
<p>补充：@SuppressWarnings 的三种方法：</p>
</blockquote>
<ol>
<li>@SuppressWarnings(“unchecked”) [^ 抑制单类型的警告]</li>
<li>@SuppressWarnings(“unchecked”,“rawtypes”) [^ 抑制多类型的警告]</li>
<li>@SuppressWarnings(“all”) [^ 抑制所有类型的警告]</li>
</ol>
<h3 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufMhhxMFuSA30XB7aViccfX02icFl2HhcFc4aoyhylIf0E5CtZ0hL0JSN9YLrn6GQuqWA6YeZqtj44Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p>Inherited 补充：</p>
<ul>
<li><strong>子类</strong>会继承<strong>父类</strong>使用的注解中被@Inherited修饰的注解</li>
<li><strong>接口继承关系</strong>中，<strong>子接口</strong>不会继承<strong>父接口</strong>中的任何注解，不管<strong>父接口</strong>中使用的注解有没 被@Inherited修饰</li>
<li><strong>子类</strong>实现<strong>父接口</strong>时不会继承任何<strong>父接口</strong>中定义的注解</li>
</ul>
<h2 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h2><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufMhhxMFuSA30XB7aViccfX0sVhm5T7wk0fS8pdItdfmbgvHMjcGCEBsrZAc3Ivl4tHDuZgWIMpJ9Q/640" alt="Image" style="zoom:50%;" />

<h3 id="ElementType-注解的用途类型"><a href="#ElementType-注解的用途类型" class="headerlink" title="ElementType(注解的用途类型)"></a><strong>ElementType(注解的用途类型)</strong></h3><p>例如，若一个 Annotation 对象是 METHOD 类型，则该 Annotation 只能用来修饰方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ElementType</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  TYPE,    <span class="comment">/* 类、接口(包括注释类型)或枚举声明 */</span></span><br><span class="line"></span><br><span class="line">  FIELD,     <span class="comment">/* 字段声明(包括枚举常量) */</span></span><br><span class="line"></span><br><span class="line">  METHOD,    <span class="comment">/* 方法声明 */</span></span><br><span class="line"></span><br><span class="line">  PARAMETER,   <span class="comment">/* 参数声明 */</span></span><br><span class="line"></span><br><span class="line">  CONSTRUCTOR,  <span class="comment">/* 构造方法声明 */</span> </span><br><span class="line"></span><br><span class="line">  LOCAL_VARIABLE,  <span class="comment">/* 局部变量声明 */</span> </span><br><span class="line"></span><br><span class="line">  ANNOTATION_TYPE,  <span class="comment">/* 注释类型声明 */</span></span><br><span class="line"></span><br><span class="line">  PACKAGE     <span class="comment">/* 包声明 */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RetentionPolicy-注解作用域策略"><a href="#RetentionPolicy-注解作用域策略" class="headerlink" title="RetentionPolicy(注解作用域策略)"></a><strong>RetentionPolicy(注解作用域策略)</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">RetentionPolicy</span> </span>&#123;</span><br><span class="line"> SOURCE, <span class="comment">/* Annotation信息仅存在于编译器处理期间，编译器处理完之后就没有该 Annotation信息了 */</span></span><br><span class="line"> </span><br><span class="line"> CLASS, <span class="comment">/* 编译器将Annotation存储于类对应的.class文件中。默认行为 */</span></span><br><span class="line"> </span><br><span class="line"> RUNTIME <span class="comment">/* 编译器将Annotation存储于class文件中，并且可由JVM读入 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定义格式"><a href="#定义格式" class="headerlink" title="定义格式"></a>定义格式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> [自定义注解名]&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a><strong>注意事项</strong></h3><ol>
<li>定义的注解，自动继承了java.lang,annotation.Annotation接口</li>
<li>注解中的每一个方法，实际是声明的注解配置参数</li>
</ol>
<ul>
<li>方法的名称就是 配置参数的名称</li>
<li>方法的返回值类型，就是配置参数的类型。只能是:基本类型/Class/String/enum</li>
</ul>
<ol>
<li>可以通过default来声明参数的默认值</li>
<li>如果只有一个参数成员，一般参数名为value</li>
<li>注解元素必须要有值，我们定义注解元素时，经常使用空字符串、0作为默认值。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/14/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/jdk/JDK-lang-Reflect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/14/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/jdk/JDK-lang-Reflect/" class="post-title-link" itemprop="url">JDK-lang-Reflect</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-14 12:50:22" itemprop="dateCreated datePublished" datetime="2021-04-14T12:50:22+08:00">2021-04-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-02-06 11:20:01" itemprop="dateModified" datetime="2023-02-06T11:20:01+08:00">2023-02-06</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><p>JAVA反射机制是在运行状态中，获取任意一个类的结构 , 创建对象 , 得到方法，执行方法 , 属性；</p>
<p>这种在运行状态动态获取信息以及动态调用对象方法的功能被称为java语言的反射机制。</p>
<h3 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h3><p>Java Classloader 是JRE的一部分，负责动态加载Java类到Java虚拟机的内存空间中。</p>
<p>**BootstrapClassLoader:**嵌在JVM内核中的加载器，该加载器是用C++语言写的，主要负载加载JAVA_HOME/lib下的类库，引导启动类加载器无法被应用程序直接使用。</p>
<p>**ExtensionClassLoader(扩展类加载器):**ExtensionClassLoader是用JAVA编写，且它的父类加载器是Bootstrap。是由<code>sun.misc.Launcher$ExtClassLoader</code>实现的，主要加载JAVA_HOME/lib/ext目录中的类 库。它的父加载器是BootstrapClassLoader</p>
<p>**App ClassLoader(应用类加载器):**App ClassLoader是应用程序类加载器，负责加载应用程序classpath目录下的所有jar和class文件。它的父加载器为Ext ClassLoader</p>
<p>**双亲委派模型:**（略）</p>
<p>类通常是<strong>懒加载</strong>，即第一次使用该类时才加载。由于有了类加载器，Java运行时系统不需要知道文件与 文件系统。</p>
<h3 id="加载配置文件"><a href="#加载配置文件" class="headerlink" title="加载配置文件"></a>加载配置文件</h3><ol>
<li>给项目添加resource root目录</li>
<li>通过类加载器加载资源文件</li>
</ol>
<ul>
<li>默认加载的是src路径下的文件，但是当项目存在resource root目录时，就变为了加载 resource root下的文件了。</li>
</ul>
<h3 id="反射获取Class"><a href="#反射获取Class" class="headerlink" title="反射获取Class"></a>反射获取Class</h3><p>要想了解一个类,必须先要获取到该类的字节码文件对象。每一个字节码文件，在内存中都存在一个对应的Class类型的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(com.test.Student.class)：包名+类名，得到student类</span><br><span class="line">Student.getClass()：得到Student类</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果类在内存中不存在, 则会加载到内存。</p>
</li>
<li><p>如果类已经在内存中存在, 不会重复加载, 而是重复利用</p>
</li>
</ul>
<p><strong>特殊的类对象</strong></p>
<blockquote>
<p>基本数据类型的类对象：基本数据类型.class</p>
<p>包装类.type</p>
<p>基本数据类型包装类对象:包装类.class</p>
</blockquote>
<h3 id="反射获取-Constructor"><a href="#反射获取-Constructor" class="headerlink" title="反射获取 Constructor"></a>反射获取 Constructor</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">构造方法如下:</span><br><span class="line">Person(String name,int age)</span><br><span class="line"></span><br><span class="line">1.通过指定的参数类型,得到这个public构造方法:</span><br><span class="line">Constructor c &#x3D; p.getClass().getConstructor(String.class,int.class);</span><br><span class="line"></span><br><span class="line">2. 获取所有public构造方法</span><br><span class="line">Constructor[] c &#x3D; p.getClass().getConstructors();</span><br><span class="line"></span><br><span class="line">3.获取所有权限的单个构造方法</span><br><span class="line">getDeclaredConstructor(参数类型的class对象数组)</span><br><span class="line"></span><br><span class="line">4.获取所有权限的构造方法</span><br><span class="line">Constructor[] c &#x3D; getDeclaredConstructors();</span><br></pre></td></tr></table></figure>

<h3 id="反射通过Constructor-创建对象"><a href="#反射通过Constructor-创建对象" class="headerlink" title="反射通过Constructor 创建对象"></a>反射通过Constructor 创建对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object class &#x3D; newInstance(Object... para);</span><br><span class="line">Student std &#x3D; (Student)class;</span><br></pre></td></tr></table></figure>

<h3 id="反射获取-Method"><a href="#反射获取-Method" class="headerlink" title="反射获取 Method"></a>反射获取 Method</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.通过class对象 获取一个类的方法</span><br><span class="line">getMethod(String methodName , class.. clss)</span><br><span class="line"></span><br><span class="line">2.得到一个类的所有方法 (public修饰的)</span><br><span class="line">getMethods();</span><br><span class="line"></span><br><span class="line">3.根据参数列表的类型和方法名, 得到一个方法(除继承以外所有的:包含私有, 共有, 保护, 默认)</span><br><span class="line">getDeclaredMethod(String methodName , class.. clss)</span><br><span class="line"></span><br><span class="line">4.得到一个类的所有方法 (除继承以外所有的:包含私有, 共有, 保护, 默认)</span><br><span class="line">getDeclaredMethods();</span><br></pre></td></tr></table></figure>

<p><strong>Method 执行方法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.调用方法,参数1:要调用方法的对象;参数2:要传递的参数列表</span><br><span class="line">method.invoke(Object o,Object... para) :</span><br></pre></td></tr></table></figure>



<h3 id="反射获取-Field"><a href="#反射获取-Field" class="headerlink" title="反射获取 Field"></a>反射获取 Field</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.根据属性的名称，获取一个类的属性</span><br><span class="line">clz.getDeclaredField(String filedName)</span><br><span class="line"></span><br><span class="line">2.获取所有属性</span><br><span class="line">clz.getDeclaredFields()</span><br><span class="line"></span><br><span class="line">3.根据属性的名称，获取一个类的public属性</span><br><span class="line">getField(String filedName)</span><br><span class="line"></span><br><span class="line">4.获取所有属性 (public)</span><br><span class="line">getFields()</span><br></pre></td></tr></table></figure>

<p><strong>Field 属性的对象类型</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.参数: 要获取属性的对象 获取指定对象的此属性值</span><br><span class="line">field.get(Object o);</span><br><span class="line">   </span><br><span class="line">2.参数1：要设置属性值的对象；参数2：要设置的值设置指定对象的属性的值</span><br><span class="line">field.set(Object o , Object value);</span><br><span class="line">   </span><br><span class="line">3.获取属性的名称 </span><br><span class="line">field.getName();</span><br><span class="line">   </span><br><span class="line">4.如果flag为true 则表示忽略访问权限检查 !(可以访问任何权限的属性)</span><br><span class="line">setAccessible(boolean flag);</span><br></pre></td></tr></table></figure>



<h3 id="通过反射获取注解信息"><a href="#通过反射获取注解信息" class="headerlink" title="通过反射获取注解信息"></a>通过反射获取注解信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取类/属性/方法的全部注解对象</span></span><br><span class="line">Annotation[] annotations01 = Class/Field/Method.getAnnotations();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Annotation annotation : annotations01) &#123;</span><br><span class="line">    System.out.println(annotation);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据类型获取类/属性/方法的注解对象</span></span><br><span class="line">注解类型 对象名 = (注解类型) c.getAnnotation(注解类型.class);</span><br></pre></td></tr></table></figure>

<h3 id="Introspector获取JavaBean"><a href="#Introspector获取JavaBean" class="headerlink" title="Introspector获取JavaBean"></a>Introspector获取JavaBean</h3><p>基于反射 , java所提供的一套应用到JavaBean的API</p>
<p>Bean类的定义：</p>
<ul>
<li>一个定义在包中的类 </li>
<li>拥有无参构造器</li>
<li>所有属性私有</li>
<li>所有属性提供get/set方法</li>
<li>实现了序列化接口</li>
</ul>
<p>Java提供了一套java.beans包的api , 对于反射的操作, 进行了封装</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufMhhxMFuSA30XB7aViccfX0PEZpoWVlXU9Qf2EibCia3dlsHN72X9EGdkDMMExWicL1WibZ5qVtDUs9Qw/640" alt="Image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">##获取Bean类信息</span><br><span class="line">BeanInfo getBeanInfo(Class cls)</span><br><span class="line"></span><br><span class="line">##获取bean类的get&#x2F;set方法数组</span><br><span class="line">MethodDescriptor[] getPropertyDescriptors():</span><br><span class="line"></span><br><span class="line">##MethodDescriptor</span><br><span class="line">Method getReadMethod():获取一个get方法</span><br><span class="line">Method getWriteMethod():获取一个set方法。有可能返回null 注意 需要加判断</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/13/database/Mybatis/mybatis-01-%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/13/database/Mybatis/mybatis-01-%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">mybatis-01-入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-04-13 18:33:58 / Modified: 18:34:40" itemprop="dateCreated datePublished" datetime="2021-04-13T18:33:58+08:00">2021-04-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">第一种写法（1）：</span><br><span class="line"></span><br><span class="line">原符号       &lt;        &lt;&#x3D;      &gt;       &gt;&#x3D;       &amp;        &#39;        &quot;</span><br><span class="line">替换符号    &lt;    &lt;&#x3D;   &gt;    &gt;&#x3D;   &amp;   &amp;apos;  &quot;</span><br><span class="line">例如：sql如下：</span><br><span class="line">create_date_time &gt;&#x3D; #&#123;startTime&#125; and  create_date_time &lt;&#x3D; #&#123;endTime&#125;</span><br><span class="line"></span><br><span class="line">第二种写法（2）：</span><br><span class="line">大于等于</span><br><span class="line">&lt;![CDATA[ &gt;&#x3D; ]]&gt;</span><br><span class="line">小于等于</span><br><span class="line">&lt;![CDATA[ &lt;&#x3D; ]]&gt;</span><br><span class="line">例如：sql如下：</span><br><span class="line">create_date_time &lt;![CDATA[ &gt;&#x3D; ]]&gt; #&#123;startTime&#125; and  create_date_time &lt;![CDATA[ &lt;&#x3D; ]]&gt; #&#123;endTime&#125;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「转角人生」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;xuanzhangran&#x2F;article&#x2F;details&#x2F;60329357</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/13/database/Mybatis/mybatis-02%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/13/database/Mybatis/mybatis-02%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8/" class="post-title-link" itemprop="url">mybatis-自定义拦截器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-13 13:04:10" itemprop="dateCreated datePublished" datetime="2021-04-13T13:04:10+08:00">2021-04-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-04-22 13:45:03" itemprop="dateModified" datetime="2022-04-22T13:45:03+08:00">2022-04-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>首先熟悉一下Mybatis的执行过程，如下图：</p>
<img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbuegug4Q7S6Wwqc0yH4pia6z3sTLNItu74rpxaibkopwwJ78osHCNjbw40aWj7YraIlZtwmLl4fwibRlw/640" alt="Image" />

<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>先说明Mybatis中可以被拦截的类型具体有以下四种：</p>
<ol>
<li>Executor：拦截执行器的方法。</li>
<li>ParameterHandler：拦截参数的处理。</li>
<li>ResultHandler：拦截结果集的处理。</li>
<li>StatementHandler：拦截Sql语法构建的处理。</li>
</ol>
<h2 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h2><p>Intercepts注解需要一个Signature(拦截点)参数数组。通过Signature来指定拦截哪个对象里面的哪个方法。@Intercepts注解定义如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Documented</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">public @interface Intercepts &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 定义拦截点</span><br><span class="line">     * 只有符合拦截点的条件才会进入到拦截器</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Signature[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Signature来指定咱们需要拦截那个类对象的哪个方法。定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Documented</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(&#123;&#125;)</span><br><span class="line">public @interface Signature &#123;</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 定义拦截的类 Executor、ParameterHandler、StatementHandler、ResultSetHandler当中的一个</span><br><span class="line">   *&#x2F;</span><br><span class="line">  Class&lt;?&gt; type();</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 在定义拦截类的基础之上，在定义拦截的方法</span><br><span class="line">   *&#x2F;</span><br><span class="line">  String method();</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 在定义拦截方法的基础之上在定义拦截的方法对应的参数，</span><br><span class="line">   * JAVA里面方法可能重载，故注意参数的类型和顺序</span><br><span class="line">   *&#x2F;</span><br><span class="line">  Class&lt;?&gt;[] args();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>标识拦截注解@Intercepts规则使用,简单实例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Intercepts(&#123;&#x2F;&#x2F;注意看这个大花括号，也就这说这里可以定义多个@Signature对多个地方拦截，都用这个拦截器</span><br><span class="line">        @Signature(</span><br><span class="line">                type &#x3D; ResultSetHandler.class,</span><br><span class="line">                method &#x3D; &quot;handleResultSets&quot;, </span><br><span class="line">                args &#x3D; &#123;Statement.class&#125;),</span><br><span class="line">        @Signature(type &#x3D; Executor.class,</span><br><span class="line">                method &#x3D; &quot;query&quot;,</span><br><span class="line">                args &#x3D; &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>说明：@Intercepts：标识该类是一个拦截器；</p>
<p>@Signature：指明自定义拦截器需要拦截哪一个类型，哪一个方法；</p>
<ul>
<li>type：上述四种类型中的一种；</li>
<li>method：对应接口中的哪类方法（因为可能存在重载方法）；</li>
<li>args：对应哪一个方法的入参；</li>
</ul>
<p>method中对应四种的类型的方法：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbuegug4Q7S6Wwqc0yH4pia6z3QLEXojbN3JpNNh3OTw2iaRjP8p5DcCH5c5Ao3yrBgLmonoULw8GoyyQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>谈到自定义拦截器实践部分，主要按照以下三步：</p>
<h3 id="step1-实现接口"><a href="#step1-实现接口" class="headerlink" title="step1: 实现接口"></a>step1: 实现接口</h3><p>org.apache.ibatis.plugin.Interceptor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface Interceptor &#123;</span><br><span class="line">    Object intercept(Invocation var1) throws Throwable;</span><br><span class="line">    Object plugin(Object var1);</span><br><span class="line">    void setProperties(Properties var1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="intercept-Invocation-invocation"><a href="#intercept-Invocation-invocation" class="headerlink" title="intercept(Invocation invocation)"></a>intercept(Invocation invocation)</h4><p>从上面我们了解到interceptor能够拦截的四种类型对象，此处入参invocation便是指拦截到的对象。</p>
<p>举例说明：拦截 <strong>StatementHandler#query(Statement st,ResultHandler rh)</strong> 方法，那么Invocation就是该对象。</p>
<h4 id="plugin-Object-target"><a href="#plugin-Object-target" class="headerlink" title="plugin(Object target)"></a>plugin(Object target)</h4><p>这个方法的作用是就是让mybatis判断，是否要进行拦截，然后做出决定是否生成一个代理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public Object plugin(Object target) &#123;</span><br><span class="line">&#x2F;&#x2F;判断是否拦截这个类型对象（根据@Intercepts注解决定），然后决定是返回一个代理对象还是返回原对象。</span><br><span class="line">&#x2F;&#x2F;故我们在实现plugin方法时，要判断一下目标类型，如果是插件要拦截的对象时才执行Plugin.wrap方法，否则的话，直接返回目标本身。</span><br><span class="line">    if (target instanceof StatementHandler) &#123;</span><br><span class="line">        return Plugin.wrap(target, this);</span><br><span class="line">    &#125;</span><br><span class="line">    return target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意:每经过一个拦截器对象都会调用插件的plugin方法，也就是说，该方法会调用4次。根据@Intercepts注解来决定是否进行拦截处理。</p>
<h4 id="setProperties-Properties-properties"><a href="#setProperties-Properties-properties" class="headerlink" title="setProperties(Properties properties)"></a>setProperties(Properties properties)</h4><p>拦截器需要一些变量对象，而且这个对象是支持可配置的。</p>
<h3 id="step2-添加拦截器注解"><a href="#step2-添加拦截器注解" class="headerlink" title="step2: 添加拦截器注解"></a>step2: 添加拦截器注解</h3><p>@Intercepts{…}。具体值遵循上述规则设置。</p>
<h3 id="step3-配置文件中添加拦截器"><a href="#step3-配置文件中添加拦截器" class="headerlink" title="step3: 配置文件中添加拦截器"></a>step3: 配置文件中添加拦截器</h3><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p><strong>自定义拦截器</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@Intercepts(value &#x3D; &#123;@Signature(type &#x3D; StatementHandler.class, method &#x3D; &quot;prepare&quot;, args &#x3D; &#123;Connection.class, Integer.class&#125;)&#125;)</span><br><span class="line">public class MyInterceptor implements Interceptor &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object intercept(Invocation invocation) throws Throwable &#123;</span><br><span class="line">        StatementHandler statementHandler &#x3D; (StatementHandler) invocation.getTarget();</span><br><span class="line">        BoundSql boundSql &#x3D; statementHandler.getBoundSql();</span><br><span class="line">        Object obj &#x3D; boundSql.getParameterObject();</span><br><span class="line">        String sql &#x3D; boundSql.getSql();</span><br><span class="line">        if (sql.trim().toUpperCase().startsWith(&quot;INSERT&quot;)) &#123;</span><br><span class="line">            ReflectUtil.setFieldValue(obj, &quot;rev&quot;, 0);</span><br><span class="line">            ReflectUtil.setFieldValue(obj, &quot;createTime&quot;, new Date());</span><br><span class="line">            ReflectUtil.setFieldValue(obj, &quot;operateTime&quot;, new Date());</span><br><span class="line">            ReflectUtil.setFieldValue(boundSql,&quot;parameterObject&quot;, obj);</span><br><span class="line"></span><br><span class="line">        &#125; else if (sql.trim().toUpperCase().startsWith(&quot;UPDATE&quot;)) &#123;</span><br><span class="line">            sql &#x3D; sql.replaceAll(&quot; set &quot;, &quot; SET &quot;)</span><br><span class="line">                    .replaceAll(&quot; Set &quot;, &quot; SET &quot;)</span><br><span class="line">                    .replaceAll(&quot; SET &quot;, &quot; SET rev &#x3D; rev+1, operate_time &#x3D; NOW(), &quot;);</span><br><span class="line">            ReflectUtil.setFieldValue(boundSql,&quot;sql&quot;, sql);</span><br><span class="line">        &#125;</span><br><span class="line">        return invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object plugin(Object o) &#123;</span><br><span class="line">        return Plugin.wrap(o, this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setProperties(Properties properties) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要看下核心代码方法intercept（）:</p>
<blockquote>
<p>这段代码主要目的：拦截insert和update语句，利用反射机制</p>
<ul>
<li>设置insert语句的参数rev(版本号，利用乐观锁)，第一次查询，故创建时间和操作时间相同；</li>
<li>设置update语句的参数rev(版本号)+1，统一修改其操作时间。</li>
</ul>
</blockquote>
<p><strong>mybatis-config</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;    </span><br><span class="line"> &lt;plugins&gt;</span><br><span class="line">        &lt;plugin interceptor&#x3D;&quot;com.qxy.mybatis.interceptor.MyInterceptor&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<p><strong>application.yml</strong></p>
<p>特别重要的一点，一定将mybatis-config中的对象注入到Sprint容器中，否则不会生效。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...&#x2F;&#x2F;省略其他配置</span><br><span class="line">mybatis:</span><br><span class="line">  config-location: classpath:&#x2F;mybatis-config.xml</span><br></pre></td></tr></table></figure>

<p><strong>ReflectUtil</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public class ReflectUtil &#123;</span><br><span class="line"></span><br><span class="line">    private ReflectUtil() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 利用反射获取指定对象的指定属性</span><br><span class="line">     * @param obj 目标对象</span><br><span class="line">     * @param fieldName 目标属性</span><br><span class="line">     * @return 目标字段</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Field getField(Object obj, String fieldName) &#123;</span><br><span class="line">        Field field &#x3D; null;</span><br><span class="line">        for (Class&lt;?&gt; clazz &#x3D; obj.getClass(); clazz !&#x3D; Object.class; clazz &#x3D; clazz.getSuperclass()) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                field &#x3D; clazz.getDeclaredField(fieldName);</span><br><span class="line">                break;</span><br><span class="line">            &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">                &#x2F;&#x2F;这里不用做处理，子类没有该字段，可能父类有，都没有就返回null</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return field;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 利用反射设置指定对象的指定属性为指定的值</span><br><span class="line">     * @param obj 目标对象</span><br><span class="line">     * @param fieldName 目标属性</span><br><span class="line">     * @param fieldValue 目标值</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void setFieldValue(Object obj, String fieldName, Object fieldValue) throws IllegalAccessException &#123;</span><br><span class="line">        Field field &#x3D; getField(obj, fieldName);</span><br><span class="line">        if (field !&#x3D; null) &#123;</span><br><span class="line">            field.setAccessible(true);</span><br><span class="line">            field.set(obj, fieldValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>debug</strong></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbuegug4Q7S6Wwqc0yH4pia6z33MrmSYBaiau2kuJPySVs6ibCdob3iaSY7Ewo7YZNGsEKNm1mEQbuRUKJg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p>上图中能够看到BoundSql对象中主要存储的属性值，所以我们自定义拦截器时，主要针对BoundSql的属性值进行修改。</p>
<p>程序代码现在没有走到我们反射机制设置值的位置，可以看到测试createTime=null;</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbuegug4Q7S6Wwqc0yH4pia6z3ic5POjnRNQ4r50l9Jwv3sJIeLlqsdqssDkZDVQibd2IgNEPozCnic7FQA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image"></p>
<p>继续跟进，程序代码返回之前，看下BoundSql对象的值，可以看到创建时间已被赋值。</p>
<img src="https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbuegug4Q7S6Wwqc0yH4pia6z3sTLNItu74rpxaibkopwwJ78osHCNjbw40aWj7YraIlZtwmLl4fwibRlw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1" alt="Image" style="zoom:50%;" />
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/17/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" href="/page/19/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fei Qi</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
