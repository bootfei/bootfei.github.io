<!DOCTYPE html>
<html lang="en,cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta name="description" content="https:&#x2F;&#x2F;howtoprogram.xyz&#x2F;2016&#x2F;05&#x2F;29&#x2F;create-multi-threaded-apache-kafka-consumer&#x2F; Why do we need multi-thread consumer model?Suppose we implement a notification module which allow users to subscribe fo">
<meta property="og:type" content="article">
<meta property="og:title" content="kafka-消费者实现多线程">
<meta property="og:url" content="http://example.com/2021/03/17/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F-%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/kafka-05-%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B/index.html">
<meta property="og:site_name" content="BootFei&#39;s Blog">
<meta property="og:description" content="https:&#x2F;&#x2F;howtoprogram.xyz&#x2F;2016&#x2F;05&#x2F;29&#x2F;create-multi-threaded-apache-kafka-consumer&#x2F; Why do we need multi-thread consumer model?Suppose we implement a notification module which allow users to subscribe fo">
<meta property="og:locale">
<meta property="og:image" content="https://howtoprogram.xyz/wp-content/uploads/2016/05/Model1.png">
<meta property="og:image" content="https://howtoprogram.xyz/wp-content/uploads/2016/05/model2.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/735367/201612/735367-20161202110008787-550483601.png">
<meta property="og:image" content="https://howtoprogram.xyz/wp-content/uploads/2016/05/Source-Code.png">
<meta property="og:image" content="https://howtoprogram.xyz/wp-content/uploads/2016/05/multiple2.jpg">
<meta property="og:image" content="https://howtoprogram.xyz/wp-content/uploads/2016/05/single.jpg">
<meta property="article:published_time" content="2021-03-17T00:42:46.000Z">
<meta property="article:modified_time" content="2021-09-02T05:52:45.156Z">
<meta property="article:author" content="Fei Qi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://howtoprogram.xyz/wp-content/uploads/2016/05/Model1.png">


<link rel="canonical" href="http://example.com/2021/03/17/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F-%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/kafka-05-%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en,cn'
  };
</script>

  <title>kafka-消费者实现多线程 | BootFei's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">BootFei's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">敬畏耶和华是智慧的开端，认识至圣者就是聪明</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-do-we-need-multi-thread-consumer-model"><span class="nav-number">1.</span> <span class="nav-text">Why do we need multi-thread consumer model?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multi-threaded-Apache-Kafka-consumer-model"><span class="nav-number">2.</span> <span class="nav-text">Multi-threaded Apache Kafka consumer model</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-consumers-with-their-own-threads"><span class="nav-number">2.1.</span> <span class="nav-text">Multiple consumers with their own threads</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Single-consumer-multiple-worker-processing-threads"><span class="nav-number">2.2.</span> <span class="nav-text">Single consumer, multiple worker processing threads</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implementation"><span class="nav-number">3.</span> <span class="nav-text">Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-consumers-with-their-own-threads-1"><span class="nav-number">3.1.</span> <span class="nav-text">Multiple consumers with their own threads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-Diagram"><span class="nav-number">3.1.1.</span> <span class="nav-text">Class Diagram</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NotificationProducerThread-java"><span class="nav-number">3.1.2.</span> <span class="nav-text">NotificationProducerThread.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NotificationConsumerThread-java"><span class="nav-number">3.1.3.</span> <span class="nav-text">NotificationConsumerThread.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NotificationConsumerGroup-java"><span class="nav-number">3.1.4.</span> <span class="nav-text">NotificationConsumerGroup.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MultipleConsumersMain-java"><span class="nav-number">3.1.5.</span> <span class="nav-text">MultipleConsumersMain.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81-Run-the-example"><span class="nav-number">3.1.6.</span> <span class="nav-text">验证 Run the example</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Single-consumer-multiple-worker-processing-threads-1"><span class="nav-number">3.2.</span> <span class="nav-text">Single consumer, multiple worker processing threads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-Diagram-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">Class Diagram</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NotificationProducerThread-java-1"><span class="nav-number">3.2.2.</span> <span class="nav-text">NotificationProducerThread.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ConsumerThreadHandler-java"><span class="nav-number">3.2.3.</span> <span class="nav-text">ConsumerThreadHandler.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NotificationConsumer-java"><span class="nav-number">3.2.4.</span> <span class="nav-text">NotificationConsumer.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SingleConsumerMain-java"><span class="nav-number">3.2.5.</span> <span class="nav-text">SingleConsumerMain.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81-Run-the-example-1"><span class="nav-number">3.2.6.</span> <span class="nav-text">验证 Run the example.</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">4.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Fei Qi</p>
  <div class="site-description" itemprop="description">learn more, forget more; practice more, get more.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">246</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en,cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/17/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F-%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/kafka-05-%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Fei Qi">
      <meta itemprop="description" content="learn more, forget more; practice more, get more.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BootFei's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          kafka-消费者实现多线程
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-17 08:42:46" itemprop="dateCreated datePublished" datetime="2021-03-17T08:42:46+08:00">2021-03-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-09-02 13:52:45" itemprop="dateModified" datetime="2021-09-02T13:52:45+08:00">2021-09-02</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><a target="_blank" rel="noopener" href="https://howtoprogram.xyz/2016/05/29/create-multi-threaded-apache-kafka-consumer/">https://howtoprogram.xyz/2016/05/29/create-multi-threaded-apache-kafka-consumer/</a></p>
<h2 id="Why-do-we-need-multi-thread-consumer-model"><a href="#Why-do-we-need-multi-thread-consumer-model" class="headerlink" title="Why do we need multi-thread consumer model?"></a>Why do we need multi-thread consumer model?</h2><p>Suppose we implement a notification module which allow users to subscribe for notifications from other users, other applications.Our module reads messages which will be written by other users, applications to a Kafka clusters. In this case, we can get all notifications of the others written to a Kafka topic and our module will create a consumer to subscribe to that topic.</p>
<p>Everything seems to be fine at the beginning. However, what will happen if the number of notifications produced by other applications, users…is <a href="">increased fast and exceed the rate that can be processed by our module（就是消费者集群）</a>?</p>
<p>Well, everything is still…not bad. All the messages/notifications that haven’t been processed by our module, are still in the Kafka topic. However, things get more danger when the number of messages is too much. Some of them will be lost when the retention policy is met (Note that Kafka retention policy can be time-based, partition size-based, key-based). And more important, when our notification module falls very far behind the income notifications/messages, it is not a true “notification” module anymore. <!--消息挤压--></p>
<p>It’s time to think about the multi-thread consumer model.</p>
<h2 id="Multi-threaded-Apache-Kafka-consumer-model"><a href="#Multi-threaded-Apache-Kafka-consumer-model" class="headerlink" title="Multi-threaded Apache Kafka consumer model"></a>Multi-threaded Apache Kafka consumer model</h2><p>There are 2 possible models I’d like to mention in this post.</p>
<ul>
<li>Multiple consumers with their own threads (Model #1) <!--每个consumer一定在不同的JVM？不是，multi consumer体现在了执行多次new  KafkaConsumer<String, String>--></li>
<li>Single consumer, multiple worker processing threads (Model #2) <!--1个consumer在一个JVM中，JVM中包含多个线程--></li>
</ul>
<p>Both of them have their own pros and cons</p>
<h3 id="Multiple-consumers-with-their-own-threads"><a href="#Multiple-consumers-with-their-own-threads" class="headerlink" title="Multiple consumers with their own threads"></a>Multiple consumers with their own threads</h3><p><font color="red">每个线程维护一个KafkaConsumer实例</font></p>
<blockquote>
<p>multi consumer体现在了执行多次new  KafkaConsumer&lt;String, String&gt;，所以有多个TCP链接，一个KafkaConsumer对应一个TCP链接</p>
<p>线程池的Thread各自维护一个 KafkaConsumer&lt;String, String&gt;实例</p>
</blockquote>
<p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/Model1.png" alt="Multi-threaded Apache Kafka Consumer - Multiple consumers with their own threads"></p>
<p>Multiple consumers with their own threads</p>
<table>
<thead>
<tr>
<th><strong>Pros</strong></th>
<th><strong>Cons</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Easy to implement</td>
<td><a href="">The total of consumers is limited the total partitions of the topic</a>. The redundant consumers may not be used.</td>
</tr>
<tr>
<td>Implementing in-order processing on per-partition is easier. <!--这个非常有用，有序性有很多应用场景--></td>
<td><a href="">More TCP connections to the brokers</a></td>
</tr>
</tbody></table>
<h3 id="Single-consumer-multiple-worker-processing-threads"><a href="#Single-consumer-multiple-worker-processing-threads" class="headerlink" title="Single consumer, multiple worker processing threads"></a>Single consumer, multiple worker processing threads</h3><p><font color="red">维护一个KafkaConsumer即Notification Consumer <!--其实吧，有可能有多个--> ，同时维护多个事件处理线程(worker thread)</font></p>
<p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/model2.png" alt="Single consumer, multiple worker processing threads"></p>
<p><img src="https://images2015.cnblogs.com/blog/735367/201612/735367-20161202110008787-550483601.png" alt="img"></p>
<p>Single consumer, multiple worker processing threads</p>
<table>
<thead>
<tr>
<th><strong>Pros</strong></th>
<th><strong>Cons</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Be flexible in scale out the number of processing thread</td>
<td>It’s not easy to implement in-order processing on per partition. Let’s say there are 2 messages on the same partitions being processed by 2 different threads. To guarantee the order, those 2 threads must be coordinated somehow. <!--其实从业务角度讲，使用消息队列并不能保障有序性，都是要自己实现的--></td>
</tr>
</tbody></table>
<p>当然，这种方法还可以有多个变种：比如每个worker线程有自己的处理队列。consumer根据某种规则或逻辑将消息放入不同的队列。不过总体思想还是相同的，故这里不做过多展开讨论了。 </p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>Below is the implementation detail of both 2 models.</p>
<p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/Source-Code.png" alt="Create Multi-threaded Apache Kafka Consumer - Source Code"></p>
<h3 id="Multiple-consumers-with-their-own-threads-1"><a href="#Multiple-consumers-with-their-own-threads-1" class="headerlink" title="Multiple consumers with their own threads"></a>Multiple consumers with their own threads</h3><h4 id="Class-Diagram"><a href="#Class-Diagram" class="headerlink" title="Class Diagram"></a>Class Diagram</h4><p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/multiple2.jpg" alt="Multiple consumers with their own threads - Class Diagram"></p>
<p>Multiple consumers with their own threads – Class Diagram</p>
<p>The source code for this part includes 4 classes:</p>
<p><strong><em>NotificationProducerThread.java</em></strong> is a producer thread, produces message to the Kafka brokers</p>
<p><strong><em>NotificationConsumerThread.java</em></strong> is a consumer thread, consumes message from Kafka brokers</p>
<p><strong><em>NotificationConsumerGroup.java</em></strong> create a group of NotificationConsumerThread(s)</p>
<p><strong><em>MultipleConsumersMain.java</em></strong> contains the <strong>main</strong> method, run the program to produce and consume messages.</p>
<h4 id="NotificationProducerThread-java"><a href="#NotificationProducerThread-java" class="headerlink" title="NotificationProducerThread.java"></a>NotificationProducerThread.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.Callback;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.RecordMetadata;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationProducerThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaProducer&lt;String, String&gt; producer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationProducerThread</span><span class="params">(String brokers, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createProducerConfig(brokers);</span><br><span class="line">    <span class="keyword">this</span>.producer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createProducerConfig</span><span class="params">(String brokers)</span> </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">    props.put(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;all&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;retries&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    props.put(<span class="string">&quot;batch.size&quot;</span>, <span class="number">16384</span>);</span><br><span class="line">    props.put(<span class="string">&quot;linger.ms&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    props.put(<span class="string">&quot;buffer.memory&quot;</span>, <span class="number">33554432</span>);</span><br><span class="line">    props.put(<span class="string">&quot;key.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;value.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Produces 3 messages&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">      String msg = <span class="string">&quot;Message &quot;</span> + i;</span><br><span class="line">      producer.send(<span class="keyword">new</span> ProducerRecord&lt;String, String&gt;(topic, msg), <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(RecordMetadata metadata, Exception e)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">          System.out.println(<span class="string">&quot;Sent:&quot;</span> + msg + <span class="string">&quot;, Partition: &quot;</span> + metadata.partition() + <span class="string">&quot;, Offset: &quot;</span></span><br><span class="line">              + metadata.offset());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// closes producer</span></span><br><span class="line">    producer.close();</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When this producer thread runs, it will produces 5 messages to the broker.</p>
<h4 id="NotificationConsumerThread-java"><a href="#NotificationConsumerThread-java" class="headerlink" title="NotificationConsumerThread.java"></a>NotificationConsumerThread.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationConsumerThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaConsumer&lt;String, String&gt; consumer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationConsumerThread</span><span class="params">(String brokers, String groupId, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createConsumerConfig(brokers, groupId);</span><br><span class="line">    <span class="keyword">this</span>.consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">    <span class="keyword">this</span>.consumer.subscribe(Arrays.asList(<span class="keyword">this</span>.topic));</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createConsumerConfig</span><span class="params">(String brokers, String groupId)</span> </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">    props.put(<span class="string">&quot;group.id&quot;</span>, groupId);</span><br><span class="line">    props.put(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;auto.commit.interval.ms&quot;</span>, <span class="string">&quot;1000&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;session.timeout.ms&quot;</span>, <span class="string">&quot;30000&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      ConsumerRecords&lt;String, String&gt; records = consumer.poll(<span class="number">100</span>);</span><br><span class="line">      <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Receive message: &quot;</span> + record.value() + <span class="string">&quot;, Partition: &quot;</span></span><br><span class="line">            + record.partition() + <span class="string">&quot;, Offset: &quot;</span> + record.offset() + <span class="string">&quot;, by ThreadID: &quot;</span></span><br><span class="line">            + Thread.currentThread().getId());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When this consumer thread runs, it will poll the data from the topics or partitions.</p>
<h4 id="NotificationConsumerGroup-java"><a href="#NotificationConsumerGroup-java" class="headerlink" title="NotificationConsumerGroup.java"></a>NotificationConsumerGroup.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationConsumerGroup</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> numberOfConsumers;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String groupId;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String brokers;</span><br><span class="line">  <span class="keyword">private</span> List&lt;NotificationConsumerThread&gt; consumers;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationConsumerGroup</span><span class="params">(String brokers, String groupId, String topic,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">int</span> numberOfConsumers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.brokers = brokers;</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">    <span class="keyword">this</span>.groupId = groupId;</span><br><span class="line">    <span class="keyword">this</span>.numberOfConsumers = numberOfConsumers;</span><br><span class="line">    consumers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.numberOfConsumers; i++) &#123;</span><br><span class="line">      NotificationConsumerThread ncThread =</span><br><span class="line">          <span class="keyword">new</span> NotificationConsumerThread(<span class="keyword">this</span>.brokers, <span class="keyword">this</span>.groupId, <span class="keyword">this</span>.topic);</span><br><span class="line">      consumers.add(ncThread);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (NotificationConsumerThread ncThread : consumers) &#123;</span><br><span class="line">      Thread t = <span class="keyword">new</span> Thread(ncThread);</span><br><span class="line">      t.start();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>brokers</em></strong>: The Kafka brokers to which consumers group will connect</p>
<p><strong><em>groupId</em></strong>: The group id. All consumers on this group will have the same groupId</p>
<p><strong><em>topic</em></strong>: The topic to which the consumers group will fetch the data</p>
<p><strong><em>numberOfConsumer</em></strong>: the number of consumers will be created for the group</p>
<h4 id="MultipleConsumersMain-java"><a href="#MultipleConsumersMain-java" class="headerlink" title="MultipleConsumersMain.java"></a>MultipleConsumersMain.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.multipleconsumers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MultipleConsumersMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String brokers = <span class="string">&quot;192.168.199.134:9092&quot;</span>;</span><br><span class="line">    String groupId = <span class="string">&quot;group01&quot;</span>;</span><br><span class="line">    String topic = <span class="string">&quot;HelloKafkaTopic1&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> numberOfConsumer = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (args != <span class="keyword">null</span> &amp;&amp; args.length &gt; <span class="number">4</span>) &#123;</span><br><span class="line">      brokers = args[<span class="number">0</span>];</span><br><span class="line">      groupId = args[<span class="number">1</span>];</span><br><span class="line">      topic = args[<span class="number">2</span>];</span><br><span class="line">      numberOfConsumer = Integer.parseInt(args[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start Notification Producer Thread</span></span><br><span class="line">    NotificationProducerThread producerThread = <span class="keyword">new</span> NotificationProducerThread(brokers, topic);</span><br><span class="line">    Thread t1 = <span class="keyword">new</span> Thread(producerThread);</span><br><span class="line">    t1.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start group of Notification Consumers</span></span><br><span class="line">    NotificationConsumerGroup consumerGroup =</span><br><span class="line">        <span class="keyword">new</span> NotificationConsumerGroup(brokers, groupId, topic, numberOfConsumer);</span><br><span class="line"></span><br><span class="line">    consumerGroup.execute();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">100000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This class is the entry point, contain the <strong>main</strong> method for testing our source code. In this class we will create a producer thread to produces <a href="">5 messages</a> to the topic which has <a href="">3 partitions</a>:<strong><em>HelloKafkaTopic1</em></strong>.</p>
<p>Then we create a group of <a href="">3 consumers</a> on their own thread to consume the message from the <strong><em>HelloKafkaTopic1</em></strong> topic.</p>
<h4 id="验证-Run-the-example"><a href="#验证-Run-the-example" class="headerlink" title="验证 Run the example"></a>验证 Run the example</h4><p>Create a topic <strong><em>HelloKafkaTopic1</em></strong> with 3 partitions</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">cd</span> <span class="variable">$APACHE_KAFKA_HOME</span></span></span><br><span class="line">./bin/kafka-topics.sh --create --zookeeper localhost:2181 </span><br><span class="line">      --replication-factor 1 --partitions 3 --topic HelloKafkaTopic1</span><br></pre></td></tr></table></figure>

<!--使用100条message验证，使用5条信息很难出现效果-->

<blockquote>
<p><em>Produces 5 messages</em><br><em>Sent:Message 0, Partition: 2, Offset: 21</em><br><em>Sent:Message 3, Partition: 2, Offset: 22</em><br><em>Sent:Message 1, Partition: 1, Offset: 24</em><br><em>Sent:Message 4, Partition: 1, Offset: 25</em><br><em>Sent:Message 2, Partition: 0, Offset: 21</em><br><em>Receive message: Message 2, Partition: 0, Offset: 21, by ThreadID: 13</em><br><em>Receive message: Message 1, Partition: 1, Offset: 24, by ThreadID: 14</em><br><em>Receive message: Message 4, Partition: 1, Offset: 25, by ThreadID: 14</em><br><em>Receive message: Message 0, Partition: 2, Offset: 21, by ThreadID: 15</em><br><em>Receive message: Message 3, Partition: 2, Offset: 22, by ThreadID: 15</em></p>
</blockquote>
<p>Note that the <strong><em>HelloKafkaTopci1</em></strong> has 3 partitions.</p>
<ul>
<li><p>Kafka producer client assigned</p>
<ul>
<li>Message 0,3 to the partition #2,</li>
<li>Messages 1,4 to the partition #1 </li>
<li>Message 2 to the partition #0.</li>
</ul>
</li>
<li><p>Kafka consumer group which includes 3 consumers with their own threads with ThreadID(s): 13, 14, 15</p>
<ul>
<li>All  messages of partition #0 were consumed by the consumer thread: #13. </li>
<li>All  messages of partition #1 were consumed by the consumer thread #1. </li>
<li>All  messages of partition #2 were consumed by the consumer thread #15.</li>
</ul>
</li>
</ul>
<p>Note that you may get the different partition numbers and ThreadIDs. However, in this case, <a href="">each partition will be handled by each consumer thread</a>.</p>
<h3 id="Single-consumer-multiple-worker-processing-threads-1"><a href="#Single-consumer-multiple-worker-processing-threads-1" class="headerlink" title="Single consumer, multiple worker processing threads"></a>Single consumer, multiple worker processing threads</h3><h4 id="Class-Diagram-1"><a href="#Class-Diagram-1" class="headerlink" title="Class Diagram"></a>Class Diagram</h4><p><img src="https://howtoprogram.xyz/wp-content/uploads/2016/05/single.jpg" alt=" Single consumer, multiple worker processing threads - Class Diagram"></p>
<p>Single consumer, multiple worker processing threads – Class Diagram</p>
<p>The source code for this part includes 4 classes too:</p>
<p><strong>NotificationProducerThread.java</strong> is a producer thread, produces message to the Kafka brokers.</p>
<p><strong>NotificationConsumer.java</strong> is a consumer which has a pool of background threads, receives message from the topic and dispatch to the the pool.</p>
<p><strong>ConsumerThreadHandler.java</strong> is a kind of worker thread which handle business processing for the message which is dispatched from the NotificationConsumer.</p>
<p><strong>SingleConsumerMain</strong>.java. includes the <strong>main</strong> method, run the program to produce and consume messages.</p>
<h4 id="NotificationProducerThread-java-1"><a href="#NotificationProducerThread-java-1" class="headerlink" title="NotificationProducerThread.java"></a><strong>NotificationProducerThread.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.singleconsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.Callback;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.RecordMetadata;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationProducerThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaProducer&lt;String, String&gt; producer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationProducerThread</span><span class="params">(String brokers, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createProducerConfig(brokers);</span><br><span class="line">    <span class="keyword">this</span>.producer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createProducerConfig</span><span class="params">(String brokers)</span> </span>&#123;</span><br><span class="line">    Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">    props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">    props.put(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;all&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;retries&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    props.put(<span class="string">&quot;batch.size&quot;</span>, <span class="number">16384</span>);</span><br><span class="line">    props.put(<span class="string">&quot;linger.ms&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    props.put(<span class="string">&quot;buffer.memory&quot;</span>, <span class="number">33554432</span>);</span><br><span class="line">    props.put(<span class="string">&quot;key.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;value.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Produces 5 messages&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">      String msg = <span class="string">&quot;Message &quot;</span> + i;</span><br><span class="line">      producer.send(<span class="keyword">new</span> ProducerRecord&lt;String, String&gt;(topic, msg), <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(RecordMetadata metadata, Exception e)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">          System.out.println(<span class="string">&quot;Sent:&quot;</span> + msg + <span class="string">&quot;, Offset: &quot;</span> + metadata.offset());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// closes producer</span></span><br><span class="line">    producer.close();</span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ConsumerThreadHandler-java"><a href="#ConsumerThreadHandler-java" class="headerlink" title="ConsumerThreadHandler.java"></a>ConsumerThreadHandler.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerThreadHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> ConsumerRecord consumerRecord;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ConsumerThreadHandler</span><span class="params">(ConsumerRecord consumerRecord)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.consumerRecord = consumerRecord;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Process: &quot;</span> + consumerRecord.value() + <span class="string">&quot;, Offset: &quot;</span> + consumerRecord.offset()</span><br><span class="line">        + <span class="string">&quot;, By ThreadID: &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This thread processes the message dispatched from the consumer <!--就是消息的处理逻辑，与消息的接受逻辑解耦合了-->. In this example, it simply print out the messages, offsets on the topic and the current ThreadID.</p>
<h4 id="NotificationConsumer-java"><a href="#NotificationConsumer-java" class="headerlink" title="NotificationConsumer.java"></a>NotificationConsumer.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationConsumer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> KafkaConsumer&lt;String, String&gt; consumer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String topic;</span><br><span class="line">  <span class="comment">// Threadpool of consumers</span></span><br><span class="line">  <span class="keyword">private</span> ExecutorService executor;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NotificationConsumer</span><span class="params">(String brokers, String groupId, String topic)</span> </span>&#123;</span><br><span class="line">    Properties prop = createConsumerConfig(brokers, groupId);</span><br><span class="line">    <span class="keyword">this</span>.consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(prop);</span><br><span class="line">    <span class="keyword">this</span>.topic = topic;</span><br><span class="line">    <span class="keyword">this</span>.consumer.subscribe(Arrays.asList(<span class="keyword">this</span>.topic));</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Creates a ThreadPoolExecutor with a given number of threads to consume the messages</span></span><br><span class="line"><span class="comment">   * from the broker.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> numberOfThreads The number of threads will be used to consume the message</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">int</span> numberOfThreads)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Initialize a ThreadPool with size = 5 and use the BlockingQueue with size =1000 to</span></span><br><span class="line">    <span class="comment">// hold submitted tasks.</span></span><br><span class="line">    executor = <span class="keyword">new</span> ThreadPoolExecutor(numberOfThreads, numberOfThreads, <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">        <span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">1000</span>), <span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      ConsumerRecords&lt;String, String&gt; records = consumer.poll(<span class="number">100</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">final</span> ConsumerRecord record : records) &#123;</span><br><span class="line">        executor.submit(<span class="keyword">new</span> ConsumerThreadHandler(record));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">createConsumerConfig</span><span class="params">(String brokers, String groupId)</span> </span>&#123;</span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, brokers);</span><br><span class="line">        props.put(<span class="string">&quot;group.id&quot;</span>, groupId);</span><br><span class="line">        props.put(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;auto.commit.interval.ms&quot;</span>, <span class="string">&quot;1000&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;session.timeout.ms&quot;</span>, <span class="string">&quot;30000&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> props;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (consumer != <span class="keyword">null</span>) &#123;</span><br><span class="line">      consumer.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (executor != <span class="keyword">null</span>) &#123;</span><br><span class="line">      executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!executor.awaitTermination(<span class="number">5000</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        System.out</span><br><span class="line">            .println(<span class="string">&quot;Timed out waiting for consumer threads to shut down, exiting uncleanly&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Interrupted during shutdown, exiting uncleanly&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This class contains a threadpool of ConsumerThreadHandler thread. It receives the message from the topic and dispatch the processing handler for the pool.</p>
<h4 id="SingleConsumerMain-java"><a href="#SingleConsumerMain-java" class="headerlink" title="SingleConsumerMain.java"></a>SingleConsumerMain.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtoprogram.kafka.singleconsumer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleConsumerMain</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    String brokers = <span class="string">&quot;localhost:9092&quot;</span>;</span><br><span class="line">    String groupId = <span class="string">&quot;group01&quot;</span>;</span><br><span class="line">    String topic = <span class="string">&quot;HelloKafkaTopic&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> numberOfThread = <span class="number">3</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (args != <span class="keyword">null</span> &amp;&amp; args.length &gt; <span class="number">4</span>) &#123;</span><br><span class="line">      brokers = args[<span class="number">0</span>];</span><br><span class="line">      groupId = args[<span class="number">1</span>];</span><br><span class="line">      topic = args[<span class="number">2</span>];</span><br><span class="line">      numberOfThread = Integer.parseInt(args[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Start Notification Producer Thread</span></span><br><span class="line">    NotificationProducerThread producerThread = <span class="keyword">new</span> NotificationProducerThread(brokers, topic);</span><br><span class="line">    Thread t1 = <span class="keyword">new</span> Thread(producerThread);</span><br><span class="line">    t1.start();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Start group of Notification Consumer Thread</span></span><br><span class="line">    NotificationConsumer consumers = <span class="keyword">new</span> NotificationConsumer(brokers, groupId, topic);</span><br><span class="line"> </span><br><span class="line">    consumers.execute(numberOfThread);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">100000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    consumers.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The entry point, contains the main method to run the example. </p>
<ul>
<li>It create a <strong><em>NotificationProducerThread</em></strong> thread which produces 5 messages to the topic: <strong><em>HelloKafkaTopic</em></strong>. </li>
<li>Then, <a href="">it creates a <strong><em>NotificationConsumer</em></strong> object which will receive the message from the above</a> topic and <a href="">dispatch to the pool of 3 <strong><em>ConsumerThreadHandler</em></strong> thread for processing</a>.</li>
</ul>
<h4 id="验证-Run-the-example-1"><a href="#验证-Run-the-example-1" class="headerlink" title="验证 Run the example."></a>验证 Run the example.</h4><p>The output on my eclipse is as below: <!--建议数据一定要大，比如100 message--></p>
<blockquote>
<p><em>Produces 5 messages</em><br><em>Sent:Message 0, Offset: 2602</em><br><em>Sent:Message 1, Offset: 2603</em><br><em>Process: Message 0, Offset: 2602, By ThreadID: 13</em><br><em>Process: Message 1, Offset: 2603, By ThreadID: 14</em><br><em>Sent:Message 2, Offset: 2604</em><br><em>Process: Message 2, Offset: 2604, By ThreadID: 15</em><br><em>Sent:Message 3, Offset: 2605</em><br><em>Process: Message 3, Offset: 2605, By ThreadID: 13</em><br><em>Sent:Message 4, Offset: 2606</em><br><em>Process: Message 4, Offset: 2606, By ThreadID: 14</em></p>
</blockquote>
<p>The producer produces 5 messages with offsets from 2602 ~ 2606. Those messages were processed a pool of threads with Ids: 13, 14, 15.</p>
<p>Note that you may get the different Offsets, ThreadID(s).</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>We have taken a look at how to create multi-threaded Apache Kafka consumer with 2 possible models. They have their own pros and cons and depend on the specific circumstance we will decide which one is suitable. Maybe, <a href="">there are some cases which the model #2 is suitable.</a> In this case, each partition of a topic will be handled by each consumer thread. However, if the number messages for this partition is too much and the consumer fall far behind, we may need to combine both the model #1 and model #2.</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/03/12/database/elastic/Lucene-%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84/" rel="prev" title="Lucene-底层结构">
                  <i class="fa fa-chevron-left"></i> Lucene-底层结构
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/03/20/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="next" title="设计模式">
                  设计模式 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fei Qi</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
