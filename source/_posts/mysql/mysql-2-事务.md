---
title: mysql - 2.事务
date: 2021-01-08 15:59:03
tags: [mysql]
---

## 二、事务介绍

### 1、事务概述

MySQL 是一个服务器／客户端架构的软件，对于同一个服务器来说，可以有若干个客户端与之连接，每个客户端与服务器连接上之后，就可以称之为一个会话（ Session ）。我们可以同时在不同的会话里输入各种语句，这些语句可以作为事务的一部分进行处理。不同的会话可以同时发送请求，也就是说服务器可能同时在处理多个事务，这样子就会导致不同的事务可能同时访问到相同的记录。我们前边说过事务有一个特性称之为 隔离性 ，理论上在某个事务对某个数据进行访问时，其他事务应该进行排队，当该事务提交之后，其他事务才可以继续访问这个数据。<!--这就相当与串行了，肯定是不行的--> 但是这样子的话对性能影响太大，所以设计数据库的大叔提出了各种 隔离级别 ，来最大限度的提升系统并发处理事务的能力，但是这也是以牺牲一定的 隔 离性 来达到的。

事务是数据库最为重要的机制之一，在MySQL中的事务是由存储引擎实现的，而且支持事务的存储引擎不多，我们主要讲解**InnoDB**存储引擎中的事务。

数据库事务具有ACID四大特性。ACID是以下4个词的缩写：

- 原子性(atomicity) ：事务最小工作单元，要么全成功，要么全失败 。
- 一致性(consistency)： 事务开始和结束后，数据库的完整性不会被破坏 。
- 隔离性(isolation) ：不同事务之间互不影响，四种隔离级别为RU（读未提交）、RC（读已提交）、RR（可重复读）、SERIALIZABLE （串行化）。
- 持久性(durability) ：事务提交后，对数据的修改是永久性的，即使系统故障也不会丢失 。 

### 2、隔离级别

1）未提交读（READ UNCOMMITTED/RU）

> **脏读**：一个事务读取到另一个事务未提交的数据。

如果一个事务读到了另一个未提交事务修改过的数据，那么这种 隔离级别 就称之为 `未提交读` 

2）已提交读（READ COMMITTED/RC）

> **不可重复读**：一个事务因读取到另一个事务已提交的update。导致对同一条记录读取两次以上的结果不一致。

如果一个事务只能读到另一个已经提交的事务修改过的数据，并且其他事务每对该数据进行一次修改并提交后，该事务都能查询得到最新值，那么这种 隔离级别就称之为 `已提交读` ，如图所示：

3）可重复读（REPEATABLE READ/RR）

> **幻读**：一个事务因读取到另一个事务已提交的insert数据或者delete数据。导致对同一张表读取两次以上的结果不一致。

在一些业务场景中，一个事务只能读到另一个已经提交的事务修改过的数据，但是第一次读过某条记录后，即使其他事务修改了该记录的值并且提交，该事务之后再读该条记录时，读到的仍是第一次读到的值，而不是每次都读到不同的数据。那么这种 隔离级别 就称之为 `可重复读` 

<!--MVCC解决了插入引起的幻读，但是删除引起的幻读没有解决-->