---
title: 设计模式
date: 2021-03-20 20:05:51
tags:
---



# 策略模式

## 原理

## 实践

用户可以选择多种支付方式，比如微信、支付宝、网银等

```java
#公共接口
public interface Payment{
	public void pay(Long order, double amount);
}
```

```java
#具体实现
public class AliPay implements Payment {
    @Override
    public void pay(Long order, double amount) {
        System.out.println("----支付宝支付----");
        System.out.println("支付宝支付111元");
    }
}
```



### 使用前

if判断非常的多

```java
@PostMapping("/makeOrder")
public ResultData makeOrder(@RequestBody  Order order){
  // 生成自己的订单，并且设置订单的失效时间，并且定时回滚
  //  ... 此处代码省略

  // 处理支付方式
  if(order.getType=="alipay"){ // 支付宝
    this.payService.alipay(order);
  }else if (order.getType=="weixin"){ // 微信
    this.payService.weixinpay(order);
  }else if (order.getType=="jd"){ // 京东支付
    this.payService.jtpay(order);
  }else if (order.getType=="yunshanfu"){ // 云闪付
    this.payService.yunshanfupay(order);
  }
  // 发送到mq，进行广播。
  return this.ok(order);
}
```

### 使用后

增加一个枚举类，封装各种策略

```java
public enum PayType {
    //封装各种策略的实现
    ALI_PAY("1",new AliPay()),
    WECHAT_PAY("2",new WechatPay());

    private String payType;
    private Payment payment;
  
    PayType(String payType,Payment payment){
        this.payment = payment;
        this.payType = payType;
    }
    //通过get方法获取支付方式
    public static Payment get(String payType) {
        for (PayType e : PayType.values()) { //values就是ALI_PAY和WECHAT_PAY
            if (e.payType.equals(payType)) {
                return e.payment;
            }
        }
        return null;
    }
}
```

通过枚举类，省略了很多if语句

```java
 public ResultData makeOrder(Long goodsId,String type){
   //生成本地的订单
   Order order = this.orderService.makeOrder(goodsId);
   //选择支付方式
   Payment payment = PayType.get(type);
   //进行支付
   payment.pay(order.getId(),order.getAmount());
   return this.ok();
 }
```

