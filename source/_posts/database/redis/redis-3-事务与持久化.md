---
title: redis-4-主从复制
date: 2021-01-14 15:59:03
tags: [redis]
---

# Redis事务介绍

Redis 的事务是通过 MULTI 、 EXEC 、 DISCARD 和 WATCH 这四个命令来完成的。 Redis 的单个命令都是原子性的，所以这里需要确保事务性的对象是 。 Redis 将命令集合序列化并确保处于同一事务的 的执行 Redis 不支持回滚操作。



# 事务命令

### MULTI 

- 用于标记事务块的开始。 
- Redis会将后续的命令逐个放入队列中，然后使用EXEC命令原子化地执行这个命令序列

```shell
#命令
multi
```

### EXEC 

在一个事务中执行所有先前放入队列的命令，然后恢复正常的连接状态

```shell
#命令
EXEC
```

### DISCARD 

清除所有先前在一个事务中放入队列的命令，然后恢复正常的连接状态。

```shell
#命令
DISCARD
```

## WATCH

当某个[事务需要按条件执行]时，就要使用这个命令将给定的[键设置为受监控]的状态。

```shell
watch key [key...]
```

> 使用该命令可以实现 Redis 的 。(后面实现)

## UNWATCH

清除所有先前为一个事务监控的键。

```
清除所有先前为一个事务监控的键。
```

# 事务处理失败

- Redis 语法错误 ：整个事务的命令在队列里都清除

- Redis 运行错误：在队列里正确的命令可以执行 (弱事务性) 弱事务性 :
  -  在队列里正确的命令可以执行 (非原子操作) 
  - 不支持回滚